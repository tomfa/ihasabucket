{"version":3,"file":"static/webpack/static/development/pages/index.js.adaec1db2c4063effd23.hot-update.js","sources":["webpack:///./components/Infrastructure/index.tsx","webpack:///./components/Infrastructure/utils.ts"],"sourcesContent":["/* eslint-disable react/no-array-index-key */\n\nimport { useEffect, useState } from 'react';\nimport Description from '../forms/Description.style';\nimport Header from '../Header.style';\nimport { getTerraFormPackage } from './utils';\nimport Pre from './Pre.style';\nimport List from './List.style';\nimport ListItem from './ListItem.style';\nimport Mute from './Mute.style';\nimport LoadingIcon from './LoadingIcon';\n\ntype Props = {\n  webApp: boolean;\n  staging: boolean;\n  shared: boolean;\n  staticPage: boolean;\n};\n\nconst Infrastructure = (props: Props) => {\n  const { description, mainTfContent } = getTerraFormPackage(props);\n  const [loading, setLoading] = useState<boolean>(true);\n  useEffect(() => {\n    setTimeout(() => setLoading(false), 800);\n  }, [mainTfContent]);\n  if (loading) {\n    return <LoadingIcon />;\n  }\n  return (\n    <>\n      <Header as={'h1'}>Bucket is served!</Header>\n      Just run the script below!\n      <Pre>\n        mkdir infrastructure{'\\n'}\n        cd infrastructure{'\\n'}\n        cat &lt;&lt;EOT &gt;&gt; main.tf{'\\n'}\n        {mainTfContent.map((line, i) => (\n          <span key={i}>\n            {line}\n            {'\\n'}\n          </span>\n        ))}\n        EOT{'\\n'}\n        terraform init{'\\n'}\n        terraform apply{'\\n'}\n      </Pre>\n      <Description>\n        The script above ask you for desired bucket name and AWS region.\n      </Description>\n      <Description>{description}</Description>\n      <h4>Prerequisites</h4>\n      <List>\n        <ListItem>\n          If you don&apos;t have an AWS account already, sign up at{' '}\n          <a href=\"https://portal.aws.amazon.com/billing/signup#/start\">\n            aws.amazon.com\n          </a>\n        </ListItem>\n        <ListItem>\n          If you don&apos;t have your <strong>AWS_SECRET_ACCESS_KEY</strong> and{' '}\n          <strong>AWS_ACCESS_KEY_ID</strong> handy, find those in the top right\n          corner under your name &gt; Security credentials. They should be\n          exported to your environment:\n          <Pre>\n            <Mute># Export AWS keys{'\\n'}</Mute>\n            export AWS_SECRET_ACCESS_KEY=yaAS$1...{'\\n'}\n            export AWS_ACCESS_KEY_ID=AKIA...\n          </Pre>\n        </ListItem>\n        <ListItem>\n          If you haven&apos;t already,{' '}\n          <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\">\n            install Terraform\n          </a>\n          {`\\n`}\n          <Pre>\n            <Mute># For Macs with homebrew{'\\n'}</Mute>\n            brew install hashicorp/tap/terraform\n          </Pre>\n          <Description>\n            See{' '}\n            <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\">\n              learn.hashicorp.com/tutorials/terraform/install-cli\n            </a>{' '}\n            for other platforms.\n          </Description>\n        </ListItem>\n      </List>\n    </>\n  );\n};\n\nexport default Infrastructure;\n","type Props = {\n  webApp: boolean;\n  staging: boolean;\n  shared: boolean;\n  staticPage: boolean;\n};\n\ntype TerraformPackage = {\n  mainTfContent: string[];\n  description?: string;\n};\n\nconst getMainTfContent = ({\n  webApp,\n  staging,\n  shared,\n  staticPage,\n}: Props): string[] => {\n  const source = webApp\n    ? 'git::https://github.com/tomfa/terraform-sandbox.git//s3-webfiles-with-cloudfront'\n    : \"'git::https://github.com/tomfa/terraform-sandbox.git//s3-privatefiles-with-cloudfront\";\n  // TODO: Remove aws_secret_key and access_key\n  const defaultVariables = {\n    'var.bucket_name': 'var.bucket_name',\n    'var.aws_region': 'var.aws_region',\n    'var.aws_access_key': 'var.aws_access_key',\n    'var.aws_secret_key': 'var.aws_secret_key',\n  };\n  const modules = staging\n    ? [\n        { name: 'prodbucket', variables: defaultVariables },\n        {\n          name: 'stagingbucket',\n          variables: {\n            ...defaultVariables,\n            'var.bucket_name': `\"$\\{var.bucket-name}.staging\"`,\n          },\n        },\n      ]\n    : [{ name: 'bucket', variables: defaultVariables }];\n\n  // TODO: Add options for differentiating between static and shared\n  if (shared && !webApp) {\n    // eslint-disable-next-line no-console\n    console.log('Missing support');\n  }\n  if (webApp && staticPage) {\n    // eslint-disable-next-line no-console\n    console.log('Missing support');\n  }\n\n  const lines: string[] = [];\n  modules.forEach((module) => {\n    lines.push('');\n    lines.push(`module \"${module.name}\" {`);\n    lines.push(`  source = \"${source}\"`);\n    Object.entries(module.variables).forEach(([key, value]) => {\n      lines.push(`  ${key} = ${value}`);\n    });\n    lines.push(`}`);\n  });\n  return lines;\n};\n\nconst getTerraPackageDescription = ({\n  webApp,\n  staging,\n  shared,\n  staticPage,\n}: Props): string => {\n  const count = staging ? 'two sets of' : 'a';\n  const usecase = getUseCaseDescription({ webApp, staticPage, shared });\n  const iamUserInfo = staging\n    ? 'Two sets of AWS keys will be created that are able to upload to the buckets. One for test and one for production environment'\n    : 'A set of AWS keys will be created that is able to upload to the bucket';\n  return `Once run, it will create ${count} S3 bucket + Cloudfront, configured ${usecase}. ${iamUserInfo}.`;\n};\n\nconst getUseCaseDescription = ({\n  webApp,\n  staticPage,\n  shared,\n}: {\n  webApp: boolean;\n  shared: boolean;\n  staticPage: boolean;\n}): string => {\n  if (webApp) {\n    if (staticPage) {\n      return 'to serve a solid statically generated web app';\n    }\n    return 'to serve a blazingly fast single-page web app';\n  }\n  if (shared) {\n    return 'for hosting publicly available files';\n  }\n  return 'for storing and serving files for authorized requests';\n};\n\nexport const getTerraFormPackage = (props: Props): TerraformPackage => {\n  return {\n    mainTfContent: getMainTfContent(props),\n    description: getTerraPackageDescription(props),\n  };\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAQA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAEA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAUA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AASA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AChFA;AAKA;AAAA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAJA;AAMA;AAEA;AAAA;AAAA;AAEA;AACA;AAEA;AAFA;AAFA;AAQA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAKA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AAQA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;;;;A","sourceRoot":""}