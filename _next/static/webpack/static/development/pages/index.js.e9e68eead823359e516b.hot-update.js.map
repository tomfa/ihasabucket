{"version":3,"file":"static/webpack/static/development/pages/index.js.e9e68eead823359e516b.hot-update.js","sources":["webpack:///./questions/useQuestions.ts","webpack:///./sections/Infrastructure.tsx","webpack:///./sections/Questionare.tsx","webpack:///./utils/splitbee.ts","webpack:///./utils/useUrlState.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { QUESTION_ID } from '../enums';\nimport { Answer, AnswerMap } from '../types';\nimport { useUrlState } from '../utils/useUrlState';\nimport { trail } from '../utils/splitbee';\nimport {\n  getDefaultAnswer,\n  getQuestionsToRender,\n  normalizeAnswer,\n} from './utils';\nimport { questions } from './data';\n\nconst useQuestions = () => {\n  const [answeredQuestions, setAnsweredQuestions] = useState<QUESTION_ID[]>([]);\n  const { urlData, updateUrlData } = useUrlState();\n  const [answers, setAnswers] = useState<AnswerMap>({} as AnswerMap);\n  useEffect(() => {\n    if (answeredQuestions.length > 0) {\n      return;\n    }\n    const defaultAnswers = questions.reduce(\n      (map, question) => ({\n        ...map,\n        [question.id]: getDefaultAnswer(\n          question,\n          urlData[question.id] !== undefined\n            ? String(urlData[question.id])\n            : undefined\n        ),\n      }),\n      {} as AnswerMap\n    );\n    const isFirstRender = !Object.keys(answers).length;\n    const isInitialLoadFromUrl = Object.keys(urlData).length;\n    if (isInitialLoadFromUrl) {\n      const urlQuestions = Object.keys(urlData) as QUESTION_ID[];\n\n      // TODO: dirty hack to assume that first answer is answered if there are others\n      if (\n        urlQuestions.length &&\n        !urlQuestions.includes(QUESTION_ID.bucketName)\n      ) {\n        urlQuestions.push(QUESTION_ID.bucketName);\n      }\n      setAnsweredQuestions(urlQuestions);\n      setAnswers(defaultAnswers);\n    } else if (isFirstRender) {\n      setAnswers(defaultAnswers);\n    }\n  }, [urlData, answeredQuestions]);\n  const renderQuestions = useMemo(\n    () => getQuestionsToRender(answers, answeredQuestions),\n    [answeredQuestions, answers]\n  );\n  const hasAnsweredAll = !renderQuestions.find(\n    (q) => !answeredQuestions.includes(q.id)\n  );\n  const updateAnswer = useCallback(\n    (questionId: QUESTION_ID, answer: Answer) => {\n      updateUrlData({ [String(questionId)]: normalizeAnswer(answer) });\n      setAnswers((prevAnswers) => ({\n        ...prevAnswers,\n        [questionId]: answer,\n      }));\n    },\n    [setAnswers, updateUrlData]\n  );\n  const answerQuestion = useCallback(\n    (questionId: QUESTION_ID, answer: Answer) => {\n      updateAnswer(questionId, answer);\n      setAnsweredQuestions((qs) => {\n        if (qs.includes(questionId)) {\n          return qs;\n        }\n        trail(questionId, { answer });\n        return [...qs, questionId];\n      });\n    },\n    [updateAnswer]\n  );\n  return {\n    answers,\n    renderQuestions,\n    updateAnswer,\n    answerQuestion,\n    hasAnsweredAll,\n  };\n};\n\nexport default useQuestions;\n","/* eslint-disable react/no-array-index-key */\n\nimport { useEffect, useState } from 'react';\nimport Description from '../components/forms/Description.style';\nimport Header from '../components/Header.style';\nimport { getTerraFormPackage } from '../utils/terraform';\nimport Pre from '../components/code/Pre.style';\nimport Mute from '../components/Mute.style';\nimport LoadingIcon from '../components/icons/LoadingIcon';\nimport Code from '../components/code/Code';\nimport { ShareLink } from '../components/ShareLink';\nimport { TerraformProps } from '../utils/terraform/types';\nimport { trail } from '../utils/splitbee';\n\nconst Infrastructure = (props: TerraformProps) => {\n  const { description, mainTfContent } = getTerraFormPackage(props);\n  const [loading, setLoading] = useState<boolean>(true);\n  useEffect(() => trail('completed', props), []);\n  useEffect(() => {\n    setTimeout(() => setLoading(false), 800);\n  }, [mainTfContent]);\n  if (loading) {\n    return <LoadingIcon />;\n  }\n\n  return (\n    <>\n      <Header as={'h1'}>Bucket is served!</Header>\n      Just run the script below, or share this{' '}\n      <ShareLink text={getShareTitle(props)}>configuration url</ShareLink> for\n      later.\n      <Code bucketName={props.bucketName} mainTfContent={mainTfContent} />\n      <Description style={{ fontWeight: 'bold' }}>\n        The script above will plan the infrastructure and prompt you for\n        confirmation.\n      </Description>\n      {description.map((text, i) => (\n        <Description key={i}>{text}</Description>\n      ))}\n      <Header>Prerequisites</Header>\n      <h4>AWS Account</h4>\n      <p>\n        If you don&apos;t have an AWS account already, sign up at{' '}\n        <a href=\"https://portal.aws.amazon.com/billing/signup#/start\">\n          aws.amazon.com\n        </a>\n      </p>\n      <p>\n        If you don&apos;t have your <strong>AWS_SECRET_ACCESS_KEY</strong> and{' '}\n        <strong>AWS_ACCESS_KEY_ID</strong> handy, find those in the top right\n        corner under your name &gt; Security credentials. They should be\n        exported to your environment:\n      </p>\n      <Pre>\n        <Mute># Export AWS keys{'\\n'}</Mute>\n        export AWS_SECRET_ACCESS_KEY=yaAS$1...{'\\n'}\n        export AWS_ACCESS_KEY_ID=AKIA...\n      </Pre>\n      <h4>Terraform installed</h4>\n      <p>\n        If you haven&apos;t already,{' '}\n        <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\">\n          install Terraform\n        </a>\n      </p>\n      <Pre>\n        <Mute># For Macs with homebrew{'\\n'}</Mute>\n        brew install hashicorp/tap/terraform\n      </Pre>\n      <Description>\n        See{' '}\n        <a href=\"https://learn.hashicorp.com/tutorials/terraform/install-cli\">\n          learn.hashicorp.com/tutorials/terraform/install-cli\n        </a>{' '}\n        for other platforms.\n      </Description>\n    </>\n  );\n};\n\nconst getShareTitle = ({\n  bucketName,\n  webApp,\n  region,\n  shared,\n}: TerraformProps): string | undefined => {\n  const regionPostfix = region ? ` in ${region}` : '';\n  if (bucketName && region) {\n    return `Launch ${bucketName}${regionPostfix}`;\n  }\n  if (webApp && region) {\n    return `Launch a web app ${regionPostfix}`;\n  }\n  if (!webApp && region) {\n    const aclText = shared ? 'public' : 'private';\n    return `Host ${aclText} files in ${regionPostfix}`;\n  }\n  return undefined;\n};\n\nexport default Infrastructure;\n","import scrollIntoView from 'scroll-into-view';\n\nimport { useEffect } from 'react';\nimport useQuestions from '../questions/useQuestions';\nimport { Section } from '../components/utils';\nimport RadioGroup from '../components/forms/RadioGroup';\nimport CheckboxGroup from '../components/forms/CheckboxGroup';\nimport { BOOL_VALUE, QUESTION_ID } from '../enums';\nimport {\n  CheckboxAnswer,\n  DropdownAnswer,\n  RadioAnswer,\n  TextAnswer,\n} from '../types';\nimport TextInput from '../components/forms/TextInput';\nimport DropDown from '../components/forms/Dropdown';\nimport {\n  getForwardingBucketValue,\n  getNormalizedAnswer,\n  hasAnswered,\n} from '../questions/utils';\nimport Infrastructure from './Infrastructure';\n\nconst Questionare = () => {\n  const {\n    answers,\n    renderQuestions,\n    updateAnswer,\n    answerQuestion,\n    hasAnsweredAll,\n  } = useQuestions();\n\n  useEffect(() => {\n    if (hasAnsweredAll) {\n      const element = document.getElementById('infrastructure');\n      if (element) {\n        scrollIntoView(element, { align: { top: 0, topOffset: 50 } });\n      }\n    } else if (renderQuestions.length > 1) {\n      const lastQuestion = renderQuestions[renderQuestions.length - 1];\n      const element = document.getElementById(lastQuestion.id);\n      if (element) {\n        scrollIntoView(element, { align: { top: 0, topOffset: 50 } });\n      }\n    }\n  }, [hasAnsweredAll, renderQuestions.length]);\n  return (\n    <Section>\n      {renderQuestions.map((question) => {\n        if (question.type === 'radio') {\n          const answer = answers[question.id] as RadioAnswer;\n          return (\n            <RadioGroup\n              id={question.id}\n              key={question.id}\n              options={question.options}\n              selectedOption={answer}\n              onChange={(value) => answerQuestion(question.id, value)}\n              title={question.title}\n              description={question.description}\n            />\n          );\n        }\n        if (question.type === 'dropdown') {\n          const answer = answers[question.id] as DropdownAnswer;\n          return (\n            <DropDown\n              id={question.id}\n              key={question.id}\n              options={question.options}\n              selectedOption={answer}\n              onChange={(value) => answerQuestion(question.id, value)}\n              title={question.title}\n              description={question.description}\n            />\n          );\n        }\n        if (question.type === 'checkbox') {\n          const answer = answers[question.id] as CheckboxAnswer;\n          return (\n            <CheckboxGroup\n              id={question.id}\n              key={question.id}\n              options={question.options}\n              selectedOptions={answer}\n              onChange={(value) => answerQuestion(question.id, value)}\n              title={question.title}\n              description={question.description}\n            />\n          );\n        }\n        if (question.type === 'text') {\n          const answer = answers[question.id] as TextAnswer;\n          return (\n            <TextInput\n              id={question.id}\n              key={question.id}\n              value={answer}\n              placeholder={question.placeholder}\n              placeholders={question.placeholders}\n              onChange={(value) => updateAnswer(question.id, value)}\n              onSubmit={(value) => answerQuestion(question.id, value)}\n              title={question.title}\n              description={question.description}\n            />\n          );\n        }\n        throw new Error(`Unexpected question type in ${question}`);\n      })}\n      <ScrollToAnchor id=\"infrastructure\" />\n      {hasAnsweredAll && (\n        <Infrastructure\n          webApp={hasAnswered(answers, QUESTION_ID.storageType, 'webapp')}\n          shared={hasAnswered(answers, QUESTION_ID.aclPublic, BOOL_VALUE.TRUE)}\n          staging={hasAnswered(\n            answers,\n            QUESTION_ID.stagingEnv,\n            BOOL_VALUE.TRUE\n          )}\n          staticPage={hasAnswered(\n            answers,\n            QUESTION_ID.webappIsStatic,\n            BOOL_VALUE.TRUE\n          )}\n          createCertificates={\n            hasAnswered(answers, QUESTION_ID.configureDns, BOOL_VALUE.TRUE) ||\n            hasAnswered(\n              answers,\n              QUESTION_ID.createCertificates,\n              BOOL_VALUE.TRUE\n            )\n          }\n          configureDns={hasAnswered(\n            answers,\n            QUESTION_ID.configureDns,\n            BOOL_VALUE.TRUE\n          )}\n          errorPath={getNormalizedAnswer(answers, QUESTION_ID.errorPath)}\n          forwardingBucket={getForwardingBucketValue(answers)}\n          bucketName={getNormalizedAnswer(answers, QUESTION_ID.bucketName)}\n          region={getNormalizedAnswer(answers, QUESTION_ID.region)}\n        />\n      )}\n    </Section>\n  );\n};\n\nconst ScrollToAnchor = ({ id }: { id: string }) => <div id={id} />;\n\nexport default Questionare;\n","import { Answer } from '../types';\n\nexport const trail = (\n  name: string,\n  data?: { [key: string]: string | boolean | number | null | Answer }\n) => {\n  try {\n    if (process.env.NODE_ENV === 'development') {\n      return;\n    }\n    if (sensitiveKeys.includes(name)) {\n      return;\n    }\n    const payload = data && Object.fromEntries(Object.entries(data).map(clean));\n    // @ts-ignore\n    if (!window || !window.splitbee) {\n      return;\n    }\n    // @ts-ignore\n    window.splitbee.track(name, payload);\n  } catch (error) {\n    // That's fine <3\n  }\n};\n\nconst clean = ([key, value]): string[] => {\n  if (sensitiveKeys.includes(key)) {\n    return [key, '---'];\n  }\n  if (['string', 'number', 'boolean'].includes(typeof value)) {\n    return [key, value];\n  }\n  if (!value) {\n    return [key, null];\n  }\n  if (value instanceof Array) {\n    return [key, value.map((v) => v.value).join(',')];\n  }\n  return [key, value.value];\n};\n\nconst sensitiveKeys = ['bucketName', 'forwardingBucket'];\n","import qs, { ParsedUrlQuery } from 'querystring';\nimport { NextRouter, useRouter } from 'next/router';\nimport { useCallback, useEffect, useState } from 'react';\n\ntype DataValue = string | boolean | number;\nexport type Data = { [key: string]: DataValue | DataValue[] };\n\nexport const useUrlState = () => {\n  const router: NextRouter = useRouter();\n  const [urlData, setUrlData] = useState<Data>({});\n  useEffect(() => {\n    const newData = getDataFromUrlQuery(router.query);\n    if (hasChanged(urlData, newData)) {\n      setUrlData(newData);\n    }\n  }, [JSON.stringify(router.query)]);\n  const updateUrlData = useCallback(\n    (data: Data) => {\n      const newData = filterInvalidValues({\n        ...mapToQuery(urlData),\n        ...mapToQuery(data),\n      });\n      setUrlData(newData);\n      router.push(`/?` + qs.stringify(newData));\n    },\n    [urlData]\n  );\n  return { urlData, updateUrlData };\n};\n\nconst filterInvalidValues = (data: ParsedUrlQuery): ParsedUrlQuery =>\n  Object.entries(data).reduce((map, [key, value]) => {\n    if (value) {\n      return { ...map, [key]: value };\n    }\n    return map;\n  }, {});\n\nfunction valueIsNumber(value: string) {\n  return !Number.isNaN(parseInt(value));\n}\n\nconst parseToValue = (value: string): DataValue => {\n  if (value.toLowerCase() === 'false') {\n    return false;\n  }\n  if (value.toLowerCase() === 'true') {\n    return true;\n  }\n  if (valueIsNumber(value)) {\n    return parseInt(value);\n  }\n  return value;\n};\n\nconst mapToQuery = (data: Data): ParsedUrlQuery => {\n  return Object.entries(data).reduce((map, [key, value]) => {\n    const stringValue =\n      value instanceof Array ? value.map((v) => String(v)) : String(value);\n    return {\n      ...map,\n      [key]: stringValue,\n    };\n  }, {});\n};\n\nconst getDataFromUrlQuery = (parsedUrlQuery: ParsedUrlQuery): Data => {\n  // Note: This ignores empty string values, e.g. would not support ?webapp\n  const urlState: Data = {};\n  Object.entries(parsedUrlQuery).forEach(([query, value]) => {\n    if (value) {\n      if (value instanceof Array) {\n        urlState[query] = value.map(parseToValue);\n      } else {\n        urlState[query] = parseToValue(value);\n      }\n    }\n  });\n  return urlState;\n};\n\nconst hasChanged = (oldData: Data, newData: Data): boolean => {\n  return JSON.stringify(oldData) !== JSON.stringify(newData);\n};\n"],"mappings":"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CA;AAKA;AAKA;AAQA;AAKA;AACA;AACA;AACA;AA7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;ACnJA;AAIA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACzCA;AACA;AACA;AAKA;AACA;AACA;AAFA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAEA;AAIA;AACA;AACA;AAGA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AANA;AACA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}