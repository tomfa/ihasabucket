{"version":3,"file":"static/webpack/static/development/pages/index.js.a8d014e6775c719443f5.hot-update.js","sources":["webpack:///./sections/Infrastructure.tsx","webpack:///./utils/terraform/index.ts"],"sourcesContent":["/* eslint-disable react/no-array-index-key */\n\nimport { useEffect, useState } from 'react';\nimport Description from '../components/forms/Description.style';\nimport Header from '../components/Header.style';\nimport { getTerraFormPackage } from '../utils/terraform';\nimport LoadingIcon from '../components/icons/LoadingIcon';\nimport Code from '../components/code/Code';\nimport { ShareLink } from '../components/ShareLink';\nimport { trail } from '../utils/splitbee';\nimport useQuestions, { useSummary } from '../questions/useQuestions';\nimport { Section } from '../components/utils';\nimport { getShareTitle } from '../utils/sharing';\n\nconst Infrastructure = () => {\n  const { hasAnsweredAll } = useQuestions();\n  const props = useSummary();\n  const [loading, setLoading] = useState<boolean>(true);\n  useEffect(() => trail('completed', props), []);\n  useEffect(() => {\n    if (hasAnsweredAll) {\n      setTimeout(() => setLoading(false), 800);\n    }\n  }, [hasAnsweredAll]);\n  if (!hasAnsweredAll) {\n    return null;\n  }\n  if (loading) {\n    return <LoadingIcon />;\n  }\n  const { footerText, sections } = getTerraFormPackage(props);\n\n  return (\n    <>\n      <Header as={'h1'}>Bucket is served!</Header>\n      <Description>\n      Copy-paste the commands below, or share this{' '}\n      <ShareLink text={getShareTitle(props)}>configuration url</ShareLink> for\n      later.\n      </Description>\n      {sections.map((section) => (\n          <Code\n            bucketName={props.bucketName}\n            intro={section.title}\n            footer={section.description}\n            mainTfContent={section.tfContent}\n          />\n      ))}\n      <Description style={{ fontWeight: 'bold' }}>\n        The script above will plan the infrastructure and prompt you for\n        confirmation.\n      </Description>\n      {footerText.map((text, i) => (\n        <Description key={i}>{text}</Description>\n      ))}\n    </>\n  );\n};\n\nexport default () => (\n  <Section id=\"infrastructure\" tight>\n    <Infrastructure />\n  </Section>\n);\n","/* eslint-disable camelcase */\n\nimport { getCertificateTfContent } from './certificate';\nimport { getTerraPackageDescription } from './descriptionText';\nimport { getDomainRecordTfContent, getDomainTfContent } from './dns';\nimport { getFileStorageBucketTfContent } from './fileStorage';\nimport { getRedirectBucketTfContent } from './redirect';\nimport { QuestionSummary, ModuleSpec, TerraformPackage } from './types';\nimport { getWebAppBucketTfContent } from './webApp';\nimport {\n  getOutputLines,\n  toModulesText,\n  toVariablesText,\n} from './terraformText';\nimport { getIAMUserTfContent } from './iamUser';\n\nconst getMainTfContent = (props: QuestionSummary): string[] => {\n  const modules: ModuleSpec[] = [];\n  modules.push(...getWebAppBucketTfContent(props));\n  modules.push(...getFileStorageBucketTfContent(props));\n  modules.push(...getDomainTfContent(props));\n  modules.push(...getDomainRecordTfContent(props));\n  modules.push(...getCertificateTfContent(props));\n  modules.push(...getRedirectBucketTfContent(props));\n  modules.push(...getIAMUserTfContent(props));\n\n  const lines: string[] = [];\n  lines.push(...toVariablesText(modules));\n  lines.push(...toModulesText(modules));\n  lines.push(...getOutputLines(props));\n  return lines;\n};\n\nexport const getTerraFormPackage = (\n  props: QuestionSummary\n): TerraformPackage => {\n  const createFolders = {\n    title: 'First, create a folder for your infrastructure code.',\n    tfContent: ['mkdir infrastructure', 'cd infrastructure'],\n  };\n  const mainContent = {\n    title: 'Then, create a terraform config file',\n    tfContent: [\n      `cat <<EOT >> ${props.bucketName || 'main'}.tf`,\n      ...getMainTfContent(props),\n      'EOT',\n    ],\n  };\n  const loadTerraformModules = {\n    title: 'Download the required modules',\n    tfContent: ['terraform init'],\n  };\n  const initialDnsDeploy = {\n    title: 'Create the DNS servers',\n    tfContent: ['terraform deploy --target=module.domain'],\n    description:\n      'After this command completes, it will output DNS servers. ' +\n      'Before continuing, point your registrar to use these endpoints as DNS servers.',\n  };\n  const deploy = {\n    title: 'Deploy to AWS',\n    tfContent: ['terraform deploy'],\n  };\n  return {\n    sections: [\n      createFolders,\n      mainContent,\n      loadTerraformModules,\n      props.configureDns && initialDnsDeploy,\n      deploy,\n    ].filter((m) => m),\n    footerText: getTerraPackageDescription(props),\n  };\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AACA;AAGA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAhBA;AAAA;AAAA;AACA;AAiBA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAEA;AACA;AACA;AACA;AAJA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAQA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAKA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;;;;;;;;;;;;;;;;;;;;;;;;;AC3DA;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AACA;AAFA;AAIA;AACA;AACA;AAFA;AAQA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AAHA;AAOA;AACA;AACA;AAFA;AAIA;AACA;AAMA;AAAA;AACA;AARA;AAUA;;;;A","sourceRoot":""}