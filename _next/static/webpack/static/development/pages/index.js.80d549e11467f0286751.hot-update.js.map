{"version":3,"file":"static/webpack/static/development/pages/index.js.80d549e11467f0286751.hot-update.js","sources":["webpack:///./utils/terraform/fileStorage.ts","webpack:///./utils/terraform/iamUser.ts","webpack:///./utils/terraform/names.ts","webpack:///./utils/terraform/webApp.ts"],"sourcesContent":["import { ModuleSpec, QuestionSummary } from './types';\nimport {\n  getBucketModuleNames,\n  getBucketNameTfValue,\n  getStagingBucketName,\n  getRegionTfValue\n} from \"./names\";\n\nexport const getFileStorageBucketTfContent = (\n  props: QuestionSummary\n): ModuleSpec[] => {\n  if (props.webApp) {\n    return [];\n  }\n  const tfContent: ModuleSpec[] = [];\n  const names = getBucketModuleNames(props);\n  const { bucketName, region, shared } = props;\n  tfContent.push({\n    name: names.main,\n    source: 'git::https://github.com/tomfa/terraform.git//files',\n    parameters: {\n      bucket_name: getBucketNameTfValue(bucketName),\n      aws_region: getRegionTfValue(region),\n      acl: shared ? '\"public-read\"' : '\"private\"',\n    },\n  });\n  if (props.staging) {\n    tfContent.push({\n      name: names.staging,\n      source: 'git::https://github.com/tomfa/terraform.git//files',\n      parameters: {\n        bucket_name: `\"${getStagingBucketName(bucketName)}\"`,\n        aws_region: getRegionTfValue(region),\n        acl: shared ? '\"public-read\"' : '\"private\"',\n      },\n    });\n  }\n  return tfContent;\n};\n","import { QuestionSummary, ModuleSpec } from './types';\nimport { getBucketTfValues, getIAMBucketUserNameTfValue } from \"./names\";\n\nexport const getIAMUserTfContent = (props: QuestionSummary): ModuleSpec[] => {\n  const parameters = getParams(props)\n  return [\n    {\n      name: 'user',\n      source: `git::https://github.com/tomfa/terraform.git//user`,\n      parameters,\n    },\n  ];\n};\n\nconst getParams = (props: QuestionSummary) => {\n  const allBucketNamesTf = getBucketTfValues(props);\n  const userNameTf = getIAMBucketUserNameTfValue(props.bucketName)\n  const bucketNamesTf = Object.values(allBucketNamesTf).filter(name => !!name);\n  const params: Record<string, string> = {\n    bucket_names: `[${bucketNamesTf.join(', ')}]`,\n    iam_user_name: userNameTf,\n  }\n  if (props.webApp) { params.cloudfront_distribution_ids = `[module.web-app.CLOUDFRONT_DISTRIBUTION_ID]`;\n  }\n  return params\n}\n","import { domainIsApex, domainIsWWW, getApexDomain } from '../domain';\nimport { QuestionSummary, BucketProp } from './types';\nimport { INPUT } from \"../../enums\";\n\nexport const getRegionTfValue = (region: string): string => region ? `\"${region}\"` : `var.${INPUT.AWS_REGION}`;\n\nexport const getBucketModuleNames = ({\n  webApp,\n  staging,\n  forwardingBucket,\n}: QuestionSummary): BucketProp => {\n  const genericBucketName = webApp ? 'web-app' : 'file-storage';\n  const mainBucket = staging\n    ? `${genericBucketName}-production`\n    : genericBucketName;\n  const stagingBucket = staging ? `${genericBucketName}-staging` : null;\n  return {\n    staging: stagingBucket,\n    main: mainBucket,\n    redirect: forwardingBucket ? 'redirect' : null,\n  };\n};\n\nexport const getBucketTfValues = ({\n  forwardingBucket,\n  staging,\n  bucketName\n}: QuestionSummary): BucketProp => {\n  return {\n    staging: staging ? `\"${getStagingBucketName(bucketName)}\"` : null,\n    main: getBucketNameTfValue(bucketName),\n    redirect: forwardingBucket ? `\"${forwardingBucket}\"` : null,\n  }\n}\nexport const getBucketNameTfValue = (bucketName: string): string => bucketName ? `\"${bucketName}\"` : `var.${INPUT.BUCKET_NAME}`;\nexport const getStagingBucketName = (bucketName: string): string => {\n  if (!bucketName) {\n    return `staging.\\\\$\\{var.bucket_name}`;\n  }\n  return getStagingDomain(bucketName);\n};\nexport const getIAMBucketUserNameTfValue = (bucketName: string): string => {\n  if (!bucketName) {\n    return `\"\\\\$\\{var.bucket_name}-user\"`;\n  }\n  return `\"${bucketName}-user\"`;\n};\n\nexport const getStagingDomain = (domain: string): string => {\n  if (domainIsApex(domain) || domainIsWWW(domain)) {\n    const apex = getApexDomain(domain);\n    return `staging.${apex}`;\n  }\n  return `staging-${domain}`;\n};\n\nexport const getBucketDomains = ({\n  bucketName,\n  staging,\n  forwardingBucket,\n}: QuestionSummary): BucketProp => {\n  const stagingBucket = staging ? getStagingDomain(bucketName) : null;\n  return {\n    staging: stagingBucket,\n    main: bucketName,\n    redirect: forwardingBucket || null,\n  };\n};\n","import { INPUT } from '../../enums';\nimport { ModuleSpec, QuestionSummary } from './types';\nimport {\n  getBucketModuleNames, getBucketNameTfValue, getRegionTfValue,\n  getStagingBucketName,\n  getStagingDomain\n} from \"./names\";\n\nexport const getWebAppBucketTfContent = (\n  props: QuestionSummary\n): ModuleSpec[] => {\n  if (!props.webApp) {\n    return [];\n  }\n  const names = getBucketModuleNames(props);\n  const { bucketName, region, staticPage, errorPath } = props;\n  const bucketSpec: ModuleSpec = {\n    name: names.main,\n    source: 'git::https://github.com/tomfa/terraform.git//webapp',\n    parameters: {\n      bucket_name: getBucketNameTfValue(bucketName),\n      aws_region: getRegionTfValue(region),\n      error_path: staticPage && errorPath ? `\"/${errorPath}\"` : '\"/index.html\"',\n      error_code: staticPage ? '404' : '200',\n    },\n  };\n\n  if (props.createCertificates) {\n    bucketSpec.parameters.certificate_arn =\n      'module.certificate.CERTIFICATE_ARN';\n  }\n  if (props.configureDns && bucketName) {\n    bucketSpec.parameters.domain_aliases = `[\"${bucketName}\"]`;\n  }\n\n  if (!props.staging) {\n    return [bucketSpec];\n  }\n\n  const stagingSpec: ModuleSpec = {\n    ...bucketSpec,\n    name: names.staging,\n    parameters: {\n      ...bucketSpec.parameters,\n      bucket_name: `\"${getStagingBucketName(bucketName)}\"`,\n    },\n  };\n\n  if (props.configureDns && bucketName) {\n    stagingSpec.parameters.domain_aliases = `[\"${getStagingDomain(\n      bucketName\n    )}\"]`;\n  }\n\n  return [bucketSpec, stagingSpec];\n};\n"],"mappings":";;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAOA;AAGA;AACA;AACA;AACA;AAAA;AACA;AALA;AAAA;AAAA;AAOA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAHA;AACA;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAHA;AAHA;AASA;AACA;AAAA;AACA;;;;;;;;;;;;ACrCA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAEA;AACA;AACA;AAHA;AAMA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AAFA;AACA;AAGA;AAAA;AACA;AACA;AAAA;AACA;;;;;;;;;;;;ACzBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAEA;AAAA;AAAA;AAEA;AAIA;AAAA;AAAA;AACA;AACA;AAGA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AAIA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAIA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;;;;;;;;;;;;;;;;;;;;;;ACjEA;AAMA;AAGA;AACA;AACA;AACA;AAAA;AAJA;AAAA;AAAA;AAAA;AAMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAHA;AACA;AAUA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA;AAFA;AAHA;AACA;AAQA;AACA;AAGA;AACA;AACA;AACA;;;;A","sourceRoot":""}