{"version":3,"file":"static/webpack/static/development/pages/index.js.6346f3ff4f9e66084aab.hot-update.js","sources":["webpack:///./questions/useQuestions.ts","webpack:///./questions/utils.ts"],"sourcesContent":["import { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { QUESTION_ID } from '../enums';\nimport { Answer, AnswerMap } from '../types';\nimport {\n  getDefaultAnswer,\n  getQuestionsToRender, normalizeAnswer\n} from \"./utils\";\nimport { questions } from './data';\nimport { useUrlState } from '../utils/urls';\n\nconst useQuestions = () => {\n  const [answeredQuestions, setAnsweredQuestions] = useState<QUESTION_ID[]>([]);\n  const { urlData, updateUrlData } = useUrlState();\n  const [answers, setAnswers] = useState<AnswerMap>({} as AnswerMap);\n  useEffect(() => {\n    if (answeredQuestions.length > 0) {\n      return\n    }\n    const defaultAnswers = questions.reduce(\n      (map, question) => ({\n        ...map,\n        [question.id]: getDefaultAnswer(question, urlData[question.id]),\n      }),\n      {} as AnswerMap\n    );\n    setAnsweredQuestions(Object.keys(urlData) as QUESTION_ID[]);\n    setAnswers(defaultAnswers)\n  }, [urlData, answeredQuestions]);\n  const renderQuestions = useMemo(\n    () => getQuestionsToRender(answers, answeredQuestions),\n    [answeredQuestions, answers]\n  );\n  const hasAnsweredAll = !renderQuestions.find(\n    (q) => !answeredQuestions.includes(q.id)\n  );\n  const answerQuestion = useCallback(\n    (questionId: QUESTION_ID, answer: Answer) => {\n      updateUrlData({ [String(questionId)]: normalizeAnswer(answer) });\n      setAnswers((prevAnswers) => ({\n        ...prevAnswers,\n        [questionId]: answer,\n      }));\n      setAnsweredQuestions((qs) => [...qs, questionId]);\n    },\n    [updateUrlData]\n  );\n  return { answers, renderQuestions, answerQuestion, hasAnsweredAll };\n};\n\nexport default useQuestions;\n","import { BOOL_VALUE, QUESTION_ID, VALUES } from '../enums';\nimport {\n  Answer,\n  AnswerMap,\n  CheckboxAnswer,\n  DropdownAnswer,\n  Option,\n  Question,\n  QuestionDisplayCondition,\n  QuestionType,\n  RadioAnswer,\n  TextAnswer,\n} from '../types';\nimport { questions, questionMap } from './data';\n\nexport const getDefaultAnswer = (question: Question, answer?: string): Answer => {\n  if (question.type === QuestionType.TEXT) {\n    return answer || question.defaultValue || null;\n  }\n  if (\n    question.type === QuestionType.RADIO ||\n    question.type === QuestionType.DROPDOWN\n  ) {\n    const defaultValue = answer || question.defaultValue;\n    return (\n      question.options.find((o) => o?.value === defaultValue) || null\n    );\n  }\n  if (question.type === QuestionType.CHECKBOX) {\n    const defaultValue = answer || question.defaultValue;\n    if (!defaultValue) {\n      return [];\n    }\n    if (typeof defaultValue === 'string' || typeof defaultValue === 'number') {\n      return question.options.filter((o) => o.value === defaultValue);\n    }\n    if (defaultValue instanceof Array) {\n      return question.options.filter((o) =>\n        (defaultValue as string[]).includes(o.value)\n      );\n    }\n    return null;\n  }\n};\n\nexport const normalizeAnswer = (answer: Answer): string => {\n  if (answer === null) {\n    return '';\n  }\n  if (\n    typeof answer === 'string' ||\n    typeof answer === 'number' ||\n    typeof answer === 'boolean'\n  ) {\n    return String(answer);\n  }\n  if (answer instanceof Array) {\n    return (answer as Option[]).map((o) => o.value).join(',');\n  }\n  if (answer.value !== null) {\n    return answer.value;\n  }\n  return '';\n};\n\nexport const getNormalizedAnswer = (\n  answers: AnswerMap,\n  questionId: QUESTION_ID\n): string => {\n  return normalizeAnswer(answers[questionId]);\n};\n\nexport const hasAnswered = (\n  answers: AnswerMap,\n  questionId: QUESTION_ID,\n  value: string | BOOL_VALUE | VALUES | null\n): boolean => {\n  const question = questionMap[questionId];\n  if (question.type === QuestionType.RADIO) {\n    const answer = answers[questionId] as RadioAnswer;\n    if (answer === null) {\n      return value === null;\n    }\n    return answer.value === value;\n  }\n  if (question.type === QuestionType.CHECKBOX) {\n    const answer = answers[questionId] as CheckboxAnswer;\n    if (answer === null) {\n      return value === null;\n    }\n    return !!answer.find((o) => o.value === value);\n  }\n  if (question.type === QuestionType.DROPDOWN) {\n    const answer = answers[questionId] as DropdownAnswer;\n    if (answer === null) {\n      return value === null;\n    }\n    return answer.value === value;\n  }\n  if (question.type === QuestionType.TEXT) {\n    const answer = answers[questionId] as TextAnswer;\n    if (answer === null) {\n      return value === null;\n    }\n    return answer === value;\n  }\n};\n\nconst isFulfilled = (\n  condition: QuestionDisplayCondition,\n  answers: AnswerMap\n): boolean => hasAnswered(answers, condition.questionId, condition.value);\n\nconst shouldSkip = (question: Question, answers: AnswerMap): boolean => {\n  return (\n    question.showIf && !!question.showIf.find((c) => !isFulfilled(c, answers))\n  );\n};\n\nconst getLastRenderIndex = (\n  answers: AnswerMap,\n  answeredQuestions: QUESTION_ID[],\n  startAtIndex = 0\n) => {\n  const question = questions[startAtIndex];\n  if (!question) {\n    return startAtIndex;\n  }\n  const questionMissingAnswer =\n    !answeredQuestions.includes(question.id) && !shouldSkip(question, answers);\n  if (questionMissingAnswer) {\n    return startAtIndex;\n  }\n  return getLastRenderIndex(answers, answeredQuestions, startAtIndex + 1);\n};\n\nexport const getQuestionsToRender = (\n  answers: AnswerMap,\n  answeredQuestions: QUESTION_ID[]\n): Question[] => {\n  const questionsToRender: Question[] = [];\n  const lastRenderIndex = getLastRenderIndex(answers, answeredQuestions);\n  questions.slice(0, lastRenderIndex + 1).forEach((question) => {\n    if (!shouldSkip(question, answers)) {\n      questionsToRender.push(question);\n    }\n  });\n\n  return questionsToRender;\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAIA;AAIA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AADA;AAAA;AAAA;AACA;AAGA;AACA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAMA;AACA;AACA;AACA;AACA;AAAA;AAGA;AACA;AAAA;AAEA;AAEA;AACA;AAAA;AAAA;AAIA;AAAA;AAAA;AACA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;ACjDA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAYA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAIA;AACA;AACA;AAAA;AAEA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAGA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAAA;AAKA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAEA;AAIA;AACA;AAEA;AAKA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAIA;AACA;AACA;AAAA;AAEA;AACA;AACA;AAIA;AACA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;;;;A","sourceRoot":""}