(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"/EDR":function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n("23aj")}])},"23aj":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Mt}));var r=n("q1tI"),o=n.n(r),a=n("bnak"),i=n("winv"),l=n("TCG4"),c=n("4DxX"),u=o.a.createElement,s=function(){return u(a.c,null,u(c.a,{author:"Lolrus, the bucket walrus"},u(o.a.Fragment,null,"Hosting a ",u(a.a,{secondary:!0}," web app "),"or need to store uploads? Put them in S3 buckets. It's",u(a.a,{secondary:!0}," cheap "),"and",u(a.a,{secondary:!0}," reliable"),". With CloudFront, it'll be blazingly ",u(a.a,{secondary:!0},"fast"),".")))},p=n("GEYT"),d=n.n(p),f=n("a3WO");var h,m,g,b=n("BsWD");function y(e){return function(e){if(Array.isArray(e))return Object(f.a)(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(b.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.apexForwarding="apex-forwarding",e.errorPath="error-path",e.wwwForwarding="www-forwarding",e.createCertificates="certificates",e.bucketName="bucket",e.storageType="storage",e.webappIsStatic="static",e.aclPublic="public",e.configureDns="dns",e.stagingEnv="staging",e.region="region"}(h||(h={})),function(e){e.FALSE="false",e.TRUE="true"}(m||(m={})),function(e){e.BUCKET_NAME="bucket_name",e.AWS_REGION="aws_region",e.AWS_ACCESS_KEY="aws_access_key",e.AWS_SECRET_KEY="aws_secret_key",e.ACL="acl",e.ERROR_RESPONSE_CODE="error_response_code",e.ERROR_RESPONSE_PATH="error_response_path"}(g||(g={}));var v,S;!function(e){e.WEBAPP="web-app",e.FILE_STORAGE="file-storage"}(v||(v={})),function(e){e.US_EAST_2="us-east-2",e.US_EAST_1="us-east-1",e.US_WEST_1="us-west-1",e.US_WEST_2="us-west-2",e.AF_SOUTH_1="af-south-1",e.AP_EAST_1="ap-east-1",e.AP_SOUTH_1="ap-south-1",e.AP_NORTHEAST_3="ap-northeast-3",e.AP_NORTHEAST_2="ap-northeast-2",e.AP_SOUTHEAST_1="ap-southeast-1",e.AP_SOUTHEAST_2="ap-southeast-2",e.AP_NORTHEAST_1="ap-northeast-1",e.CA_CENTRAL_1="ca-central-1",e.CN_NORTH_1="cn-north-1",e.CN_NORTHWEST_1="cn-northwest-1",e.EU_CENTRAL_1="eu-central-1",e.EU_WEST_1="eu-west-1",e.EU_WEST_2="eu-west-2",e.EU_SOUTH_1="eu-south-1",e.EU_WEST_3="eu-west-3",e.EU_NORTH_1="eu-north-1",e.SA_EAST_1="sa-east-1",e.ME_SOUTH_1="me-south-1"}(S||(S={}));var _=n("ODXe"),O=n("s4NR"),E=n.n(O),A=n("nOHt");function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){return Object.entries(e).reduce((function(e,t){var n=Object(_.a)(t,2),r=n[0],o=n[1];return o?k({},e,w({},r,o)):e}),{})};var T=function(e){return"false"!==e.toLowerCase()&&("true"===e.toLowerCase()||(function(e){return!Number.isNaN(parseInt(e))}(e)?parseInt(e):e))},N=function(e){return Object.entries(e).reduce((function(e,t){var n=Object(_.a)(t,2),r=n[0],o=n[1];return k({},e,w({},r,o instanceof Array?o.map((function(e){return String(e)})):String(o)))}),{})},D=function(e){var t={};return Object.entries(e).forEach((function(e){var n=Object(_.a)(e,2),r=n[0],o=n[1];o&&(t[r]=o instanceof Array?o.map(T):T(o))})),t},j=function(e,t){return JSON.stringify(e)!==JSON.stringify(t)},R=n("Pq1a");function x(e){var t=e.split(".");if(1===t.length)throw new Error("".concat(e," is not a valid domain"));var n=t[t.length-1],r=t[t.length-2];if(!function(e){return!e.includes(".")}(n))throw new Error("".concat(n," is not a known top level domain"));return"".concat(r,".").concat(n)}var P,W=function(e){return 2===e.split(".").length},L=function(e){return 3===e.split(".").length&&e.startsWith("www.")},U=function(e){return e.split(".").length>=2};!function(e){e.RADIO="radio",e.CHECKBOX="checkbox",e.TEXT="text",e.DROPDOWN="dropdown"}(P||(P={}));var F=function(e){return"string"===typeof e&&W(e)},Y=function(e){return"string"===typeof e&&L(e)};function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var M=[{id:h.bucketName,title:"",type:P.TEXT,placeholders:["mydomain.com","uploads.mydomain.com","staging.mydomain.com","www.mydomain.com","test.mydomain.com","uploads.mydomain.com"],description:'We will use this as the S3 bucket name. The bucket name is permanent, but it doesn\'t have to match an actual domain. It does however have to be unique on S3, so "example" or "my-bucket" will not work. If you leave it empty, you\'ll be prompted for a bucket name at deploy time.'},{id:h.configureDns,title:"Should we set up DNS pointers?",type:P.RADIO,description:"Should we setup DNS pointers and certificates for your domain? (Recommended). AWS Route 53 costs 0.5$ / month. If you select Yes, we will output the AWS DNS server urls after setting up the infrastructure. You must point to these servers from your registrar to enable them. If you select No, we will output AWS domain urls for the S3 bucket / Cloudfront, so you can set DNS up yourself.",options:[{value:m.TRUE,label:"Yes, please do."},{value:m.FALSE,label:"No, I'll handle DNS manually."}],showIf:[{questionId:h.bucketName,value:function(e){return"string"===typeof e&&U(e)}}]},{id:h.createCertificates,title:"What about certificates (HTTPS)?",type:P.RADIO,description:"Even though we don't set up DNS in AWS, we can create certificates for the domain. This is free, but will require you to set up a DNS record manually to verify the domain ownership..",options:[{value:m.TRUE,label:"Yes, please create one."},{value:m.FALSE,label:"No thanks."}],showIf:[{questionId:h.configureDns,value:m.FALSE}]},{id:h.apexForwarding,title:"Forward apex to www?",type:P.RADIO,description:"It looks like your domain name is a www domain. (e.g. www.mydomain.com). Click Yes if you want to forward the apex domain (e.g. mydomain.com) to www (e.g. www.mydomain.com)",options:[{value:m.TRUE,label:"Yes, forward my apex domain to www."},{value:m.FALSE,label:"No thanks."}],showIf:[{questionId:h.bucketName,value:Y},{questionId:h.configureDns,value:m.TRUE}]},{id:h.wwwForwarding,title:"Forward www to apex?",type:P.RADIO,description:"It looks like your domain name is an apex domain (e.g. mydomain.com). Click Yes if you want to forward the www domain (e.g. www.mydomain.com) to the apex domain.",options:[{value:m.TRUE,label:"Yes, forward www to apex domain."},{value:m.FALSE,label:"No thanks."}],showIf:[{questionId:h.bucketName,value:F},{questionId:h.configureDns,value:m.TRUE}]},{id:h.storageType,title:"What are we storing?",type:P.RADIO,description:"Unlike normal file storage, web apps like React and Vue have a default path, and error pages.",options:[{value:"webapp",label:"A web app"},{value:"files",label:"Static files or media uploads"}]},{id:h.webappIsStatic,title:"Is the web app statically generated?",type:P.RADIO,description:"Statically generated sites can be optimized for search engines by returning correct HTTP status codes. If you are uncertain, select No.",options:[{value:m.TRUE,label:"Yes (e.g. Next, Gatsby, Nuxt)"},{value:m.FALSE,label:"No (e.g. plain Vue or React)"}],showIf:[{questionId:h.storageType,value:"webapp"}]},{id:h.errorPath,title:'What\'s the "Not found" path?',type:P.TEXT,defaultValue:"404",placeholder:"404",description:'"404" would work with a /404.html or /404/index.html file. This path will be rendered in cases when the file is not found.',showIf:[{questionId:h.webappIsStatic,value:m.TRUE}]},{id:h.aclPublic,title:"Should content be publicly available?",type:P.RADIO,description:"If our files hold secret or personal information, we will need a stricter security policy than if we are storing publicly available files, e.g. media files for a CMS.",options:[{value:m.TRUE,label:"Yes, make files public"},{value:m.FALSE,label:"No, let me control access to the files"}],showIf:[{questionId:h.storageType,value:"files"}]},{id:h.region,title:"In what region do you want the buckets?",type:P.DROPDOWN,defaultValue:S.EU_NORTH_1,description:"A region closer to your users can give an extra performance boost.",options:Object.values(S).map((function(e){return{value:e,label:e}}))},{id:h.stagingEnv,title:"Want a test environment?",type:P.RADIO,description:"A staging (or test) environment would mean a duplicate set of buckets. If you're uncertain, select No. You can always create a staging environment later.",options:[{value:m.TRUE,label:"Yes, please create a separate set of buckets for testing"},{value:m.FALSE,label:"No, I won't need that"}]}],B=M.reduce((function(e,t){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,w({},t.id,t))}),{}),K=function(e){return null===e||void 0===e?"":"string"===typeof e||"number"===typeof e||"boolean"===typeof e?String(e).toLowerCase().trim():e instanceof Array?e.map((function(e){return e.value.toLowerCase().trim()})).join(","):null!==e.value?e.value.toLowerCase().trim():""},H=function(e,t){return K(e[t])},z=function(e,t,n){var r=B[t];if(!r)throw new Error("Unknown questionId ".concat(t));if(void 0===e[t])return!1;if(r.type===P.RADIO){var o=e[t];return null===o?null===n:o.value===n}if(r.type===P.CHECKBOX){var a=e[t];return null===a?null===n:!!a.find((function(e){return e.value===n}))}if(r.type===P.DROPDOWN){var i=e[t];return null===i?null===n:i.value===n}if(r.type===P.TEXT){var l=e[t];return null===l?null===n:l===n}},$=function(e,t){return!!e.showIf&&!!e.showIf.find((function(e){return!function(e,t){return"function"===typeof e.value?e.value(t[e.questionId]):z(t,e.questionId,e.value)}(e,t)}))},X=function(e,t){var n=[],r=function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=M[r];if(!o)return r;var a=!n.includes(o.id)&&!$(o,t);return a?r:e(t,n,r+1)}(e,t);return M.slice(0,r+1).forEach((function(t){$(t,e)||n.push(t)})),n},G=function(e){var t=e[h.bucketName],n=e[h.apexForwarding],r=e[h.wwwForwarding];return F(t)&&r?"www.".concat(t):Y(t)&&n?x(t):null},V=o.a.createElement;function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var J=function(){var e=Object(r.useState)(!1),t=e[0],n=e[1],o=Object(r.useState)([]),a=o[0],i=o[1],l=function(){var e=Object(A.useRouter)(),t=Object(r.useState)({}),n=t[0],o=t[1];Object(r.useEffect)((function(){var t=D(e.query);j(n,t)&&o(t)}),[JSON.stringify(e.query)]);var a=Object(r.useCallback)((function(t){var r=I(k({},N(n),{},N(t)));o(r),e.push("/?"+E.a.stringify(r))}),[n]);return{urlData:n,updateUrlData:a}}(),c=l.urlData,u=l.updateUrlData,s=Object(r.useState)({}),p=s[0],d=s[1];Object(r.useEffect)((function(){var e=Object.keys(p).length>0,n=Object.keys(c).length>0,r=a.length>0;if(!t&&!r){if(!e){var o=ee();d(o)}if(n){var l=te(c),u=ee(c);d(u),i(l)}}}),[c,p,a,t]);var f=Object(r.useMemo)((function(){return X(p,a)}),[a,p]),h=!f.find((function(e){return!a.includes(e.id)})),m=Object(r.useCallback)((function(e,t){n(!0),u(w({},String(e),K(t))),d((function(n){return Z({},n,w({},e,t))}))}),[d,u]),g=Object(r.useCallback)((function(e,t){m(e,t),i((function(n){return n.includes(e)?n:(Object(R.a)(e,{answer:t}),[].concat(y(n),[e]))}))}),[m]);return{answers:p,renderQuestions:f,updateAnswer:m,answerQuestion:g,hasAnsweredAll:h}},ee=function(e){return M.reduce((function(t,n){return Z({},t,w({},n.id,function(e,t){if(e.type===P.TEXT)return t||e.defaultValue||null;if(e.type===P.RADIO||e.type===P.DROPDOWN){var n=t||e.defaultValue;return e.options.find((function(e){return(null===e||void 0===e?void 0:e.value)===n}))||null}if(e.type===P.CHECKBOX){var r=t||e.defaultValue;return r?"string"===typeof r||"number"===typeof r?e.options.filter((function(e){return e.value===r})):r instanceof Array?e.options.filter((function(e){return r.includes(e.value)})):null:[]}}(n,e&&void 0!==e[n.id]?String(e[n.id]):void 0)))}),{})},te=function(e){var t=Object.keys(e);return t.length&&!t.includes(h.bucketName)&&t.push(h.bucketName),t},ne=o.a.createContext(void 0),re=function(e){var t=e.children,n=J(),o=Object(r.useMemo)((function(){return e=n.answers,{webApp:z(e,h.storageType,"webapp"),shared:z(e,h.aclPublic,m.TRUE),staging:z(e,h.stagingEnv,m.TRUE),staticPage:z(e,h.webappIsStatic,m.TRUE),createCertificates:U(H(e,h.bucketName))&&(z(e,h.configureDns,m.TRUE)||z(e,h.createCertificates,m.TRUE)),configureDns:U(H(e,h.bucketName))&&z(e,h.configureDns,m.TRUE),errorPath:H(e,h.errorPath),forwardingBucket:G(e),bucketName:H(e,h.bucketName),region:H(e,h.region)};var e}),[n.answers]);return V(ne.Provider,{value:{questions:n,summary:o}},t)},oe=function(){return o.a.useContext(ne).summary},ae=function(){return o.a.useContext(ne).questions},ie=n("Yr1c"),le=n("vOnD"),ce=le.c.label.withConfig({displayName:"Labelstyle__Label",componentId:"u2u342-0"})(["position:relative;cursor:pointer;padding-bottom:0.7rem;padding-top:0.7rem;padding-left:3rem;padding-right:1.2rem;margin-bottom:3px;background-color:",";color:",";border:2px solid transparent;&:before{content:'';display:block;width:",";height:20px;border:3px solid ",";position:absolute;left:",";top:",";opacity:",";-webkit-transition:all 0.12s,border-color 0.08s;transition:all 0.12s,border-color 0.08s;border-top-color:",";border-left-color:",";transform:",";}"],(function(e){return e.checked?e.theme.colors.primary:""}),(function(e){return e.checked?e.theme.colors.textSecondary:e.theme.colors.textPrimary}),(function(e){return e.checked?"10px":"20px"}),(function(e){return e.checked?"white":"black"}),(function(e){return e.checked?"18px":"13px"}),(function(e){return e.checked?"3px":"8px"}),(function(e){return e.checked?1:.6}),(function(e){return e.checked&&"transparent"}),(function(e){return e.checked&&"transparent"}),(function(e){return e.checked&&"rotate(45deg)"})),ue=le.c.input.withConfig({displayName:"Inputstyle__Input",componentId:"sc-1nl68ta-0"})(["&[type='checkbox']{width:1px;height:1px;outline:none;border:none;opacity:0;}&[type='radio']{width:1px;height:1px;outline:none;border:none;opacity:0;}&[type='text']{padding:1rem;flex:1;border:none;font-size:1.2rem;&:focus{margin-right:4px;outline:2px dashed ",";}}&:focus + ","{outline:2px dashed ",";}&:focus::placeholder{color:transparent;}"],(function(e){return e.theme.colors.primary}),ce,(function(e){return e.theme.colors.primary})),se=o.a.createElement,pe=function(e){var t=e.checked,n=e.group,r=e.onChange,a=e.value,i=e.label,l=e.disabled,c=void 0!==l&&l,u="".concat(n,"-").concat(a);return se(o.a.Fragment,null,se(ue,{id:u,value:a,name:u,type:"radio",group:n,checked:t,onChange:function(){return!c&&r(a,!t)},disabled:c}),se(ce,{htmlFor:u,checked:t},i))},de=le.c.p.withConfig({displayName:"Descriptionstyle__Description",componentId:"sc-1vej8zf-0"})(["color:",";font-size:0.8rem;font-style:italic;"],(function(e){return e.theme.colors.textMuted})),fe=le.c.div.withConfig({displayName:"Choicesstyle__Choices",componentId:"sc-1r49bg-0"})(["display:flex;flex-direction:column;"]),he=le.c.div.withConfig({displayName:"Questionstyle__Question",componentId:"sc-1ce9jof-0"})(["margin-bottom:2.5rem;&:last-of-type{margin-bottom:0rem;}"]),me=o.a.createElement,ge=function(e){var t=e.id,n=e.options,o=e.selectedOption,a=e.onChange,i=e.title,l=e.description,c=e.disabled,u=void 0!==c&&c,s=Object(r.useCallback)((function(e,t){if(!u){if(!t)return a(null);var r=n.find((function(t){return t.value===e}));r&&a(r)}}),[u,n,a]);return me(he,{id:t},i&&me(ie.a,null,i),me(fe,null,n.map((function(e){return me(pe,{key:"".concat(t,"-").concat(e.value),group:t,checked:e===o,onChange:s,value:e.value,label:e.label})}))),l&&me(de,null,l))},be=o.a.createElement,ye=function(e){var t=e.checked,n=e.onChange,r=e.value,a=e.label,i=e.group,l=e.disabled,c=void 0!==l&&l,u="".concat(i,"-").concat(r);return be(o.a.Fragment,null,be(ue,{id:u,value:r,name:u,type:"checkbox",checked:t,onChange:function(){return!c&&n(r,!t)},disabled:c}),be(ce,{htmlFor:u,checked:t},a))},we=o.a.createElement,ve=function(e){var t=e.id,n=e.options,o=e.selectedOptions,a=e.onChange,i=e.title,l=e.description,c=e.disabled,u=void 0!==c&&c,s=Object(r.useCallback)((function(e,t){if(!u){var r=o.filter((function(t){return t.value!==e}));if(!t)return a(r);var i=n.find((function(t){return t.value===e}));i&&a([].concat(y(r),[i]))}}),[u,n,a,o]);return we(he,{id:t},i&&we(ie.a,null,i),we(fe,null,n.map((function(e){return we(ye,{group:t,key:e.value,checked:o.includes(e),onChange:s,value:e.value,label:e.label})}))),l&&we(de,null,l))},Se=n("o0o1"),_e=n.n(Se),Oe=le.c.div.withConfig({displayName:"InputContainerstyles__InputContainer",componentId:"sc-17e590b-0"})(["display:flex;"]),Ee=le.c.button.withConfig({displayName:"SubmitButtonstyles__SubmitButton",componentId:"sc-75aind-0"})(["color:",";background-color:",";border:none;flex:0.5;position:relative;outline-style:dashed;outline-width:2px;cursor:pointer;&:focus,&:active{outline-color:",";}&:before{content:'';display:block;width:10px;height:20px;border:3px solid white;position:absolute;left:calc(50% - 10px);top:12px;-webkit-transition:all 0.12s,border-color 0.08s;transition:all 0.12s,border-color 0.08s;border-top-color:transparent;border-left-color:transparent;transform:rotate(45deg);}"],(function(e){return e.theme.colors.textSecondary}),(function(e){return e.complete?e.theme.colors.primary:e.theme.colors.bgMuted}),(function(e){return e.theme.colors.primary})),Ae=o.a.createElement,Ce=function(e,t,n,r){var o,i,l,c,u,s,p,d,f=arguments;return _e.a.async((function(h){for(;;)switch(h.prev=h.next){case 0:return o=f.length>4&&void 0!==f[4]?f[4]:7e3,h.next=3,_e.a.awrap(Object(a.e)(o));case 3:i=e[t%e.length],l=e[(t+1)%e.length],c=i.length+l.length+4,u=25,s=0;case 8:if(!(s<=c)){h.next=17;break}return p=s<=i.length,d=c-s<=l.length,p?r(i.substr(0,i.length-s)):d&&r(l.substr(0,l.length-(c-s))),h.next=14,_e.a.awrap(Object(a.e)(u));case 14:s++,h.next=8;break;case 17:n((function(t){return t+1%e.length}));case 18:case"end":return h.stop()}}),null,null,null,Promise)},ke=function(e){var t=e.id,n=e.onChange,o=e.onSubmit,a=e.value,i=void 0===a?"":a,l=e.title,c=e.placeholder,u=e.placeholders,s=e.description,p=Object(r.useState)((null===u||void 0===u?void 0:u.length)?0:-1),d=p[0],f=p[1],h=Object(r.useState)(-1===d?c:u[d]),m=h[0],g=h[1];Object(r.useEffect)((function(){!u||u.length<2||Ce(u,d,f,g)}),[d]);var b=Object(r.useCallback)((function(e){return e?e.toLowerCase().replace(" ","-"):""}),[]),y=Object(r.useCallback)((function(e){o(b(e))}),[o,b]);return Ae(he,{id:t},l&&Ae(ie.a,null,l),Ae(Oe,null,Ae(ue,{type:"text",value:i||"",placeholder:m,onChange:function(e){return n(e.target.value)},onKeyPress:function(e){return"Enter"===e.key&&y(i)},onBlur:function(){return y(i)}}),Ae(Ee,{type:"submit",complete:i&&i.trim().length>0,onClick:function(){return y(i)}})),s&&Ae(de,null,s))},Ie=o.a.createElement,Te=le.c.select.withConfig({displayName:"Dropdown__Select",componentId:"ca76f5-0"})(["font-size:1.2rem;padding:1rem;flex:1;border:none;appearance:none;background-color:white;&:focus,&:active{outline-style:dashed;outline-width:2px;outline-color:",";margin-right:3px;}"],(function(e){return e.theme.colors.primary})),Ne=le.c.option.withConfig({displayName:"Dropdown__Choice",componentId:"ca76f5-1"})(["color:",";"],(function(e){return e.theme.colors.textPrimary})),De=function(e){var t=e.id,n=e.options,o=e.selectedOption,a=e.onChange,i=e.title,l=e.description,c=e.disabled,u=void 0!==c&&c,s=Object(r.useCallback)((function(e){if(!u){var t=n.find((function(t){return t.value===e}));t&&a(t)}}),[u,n,a]);return Ie(he,{id:t},i&&Ie(ie.a,null,i),Ie(Oe,null,Ie(Te,{value:null===o||void 0===o?void 0:o.value,onChange:function(e){return s(e.target.value)}},n.map((function(e){return Ie(Ne,{key:"".concat(t,"-").concat(e.value),value:e.value,label:e.label},e.label)}))),Ie(Ee,{type:"submit",complete:!!o,onClick:function(){return s(o.value)}})),l&&Ie(de,null,l))},je=o.a.createElement,Re=function(){var e=ae(),t=e.answers,n=e.renderQuestions,o=e.updateAnswer,i=e.answerQuestion,l=e.hasAnsweredAll;return Object(r.useEffect)((function(){if(l){var e=document.getElementById("infrastructure");e&&d()(e,{align:{top:0,topOffset:50}})}else if(n.length>1){var t=n[n.length-1],r=document.getElementById(t.id);r&&d()(r,{align:{top:0,topOffset:50}})}}),[l,n.length]),je(a.c,null,n.map((function(e){if("radio"===e.type){var n=t[e.id];return je(ge,{id:e.id,key:e.id,options:e.options,selectedOption:n,onChange:function(t){return i(e.id,t)},title:e.title,description:e.description})}if("dropdown"===e.type){var r=t[e.id];return je(De,{id:e.id,key:e.id,options:e.options,selectedOption:r,onChange:function(t){return i(e.id,t)},title:e.title,description:e.description})}if("checkbox"===e.type){var a=t[e.id];return je(ve,{id:e.id,key:e.id,options:e.options,selectedOptions:a,onChange:function(t){return i(e.id,t)},title:e.title,description:e.description})}if("text"===e.type){var l=t[e.id];return je(ke,{id:e.id,key:e.id,value:l,placeholder:e.placeholder,placeholders:e.placeholders,onChange:function(t){return o(e.id,t)},onSubmit:function(t){return i(e.id,t)},title:e.title,description:e.description})}throw new Error("Unexpected question type in ".concat(e))})))},xe=function(e){var t=e.webApp,n=e.staging,r=e.forwardingBucket,o=t?"web-app":"file-storage",a=n?"".concat(o,"-production"):o;return{staging:n?"".concat(o,"-staging"):null,main:a,redirect:r?"redirect":null}},Pe=function(e){return e?We(e):"staging.\\${var.bucket_name}"},We=function(e){if(W(e)||L(e)){var t=x(e);return"staging.".concat(t)}return"staging-".concat(e)},Le=function(e){return[Ue(e),Fe(e)].filter((function(e){return!!e}))},Ue=function(e){return e.createCertificates?e.configureDns?"During the setup, we will request HTTPS certificates for your domain, and verify that they are set up correctly. This means that the DNS changes you made has propagate before it continues. Until then, the script will not complete. Instead, it may time out. No worries though, just re-run the script after a while, when the DNS records are correct. It will continue where it left off.":'During the setup, we will request HTTPS certificates for your domain, and verify that they are set up correctly. This means you will have to go to change your DNS pointers as specified in the Certificate Manager in the AWS console. These instructions will be shown under the certificate in status "Pending Verification", which will show up after you have start this script. Until that is done, -and- the DNS changes have propageted, the script WILL NOT COMPLETE. Instead, it will likely time out. No worries though, just re-run the script after a while, when the DNS records are correct. It will continue where it left off.':""},Fe=function(e){var t=Ye(e),n=e.staging?"two sets of":"a",r="S3 bucket".concat(e.webApp?" + Cloudfront":"",";");return"Once run successfully, the script will create ".concat(n," ").concat(r," in ").concat(e.region,", configured ").concat(t,".")},Ye=function(e){var t=e.webApp,n=e.staticPage,r=e.shared;return t?n?"to serve a solid statically generated web app":"to serve a blazingly fast single-page web app":r?"for hosting publicly available files":"for storing and serving files for authorized requests"};function qe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qe(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Be=function(e){var t=e.configureDns,n=e.forwardingBucket,r=e.staging;if(!t)return[];var o=function(e){var t=e.bucketName,n=e.staging,r=e.forwardingBucket;return{staging:n?We(t):null,main:t,redirect:r||null}}(e),a=function(e){var t=xe(e),n=function(e,t){return e?{target_name:"module.".concat(e,".")+(t?"BUCKET_WEBSITE_DOMAIN":"CLOUDFRONT_URL"),target_zone_id:"module.".concat(e,".")+(t?"BUCKET_ZONE_ID":"CLOUDFRONT_ZONE_ID")}:null};return{staging:n(t.staging,!e.webApp),main:n(t.main,!e.webApp),redirect:n(t.redirect,!0)}}(e),i=[{name:"bucket_record",source:"git::https://github.com/tomfa/terraform.git//alias_record",parameters:Me({dns_zone_id:"module.domain.DOMAIN_ZONE_ID",domain:'"'.concat(o.main,'"')},a.main)}];return r&&i.push({name:"staging_record",source:"git::https://github.com/tomfa/terraform.git//alias_record",parameters:Me({dns_zone_id:"module.domain.DOMAIN_ZONE_ID",domain:'"'.concat(o.staging,'"')},a.staging)}),n&&i.push({name:"redirect_record",source:"git::https://github.com/tomfa/terraform.git//alias_record",parameters:Me({dns_zone_id:"module.domain.DOMAIN_ZONE_ID",domain:'"'.concat(o.redirect,'"')},a.redirect)}),i};function Ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ke(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){w(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xe=function(e){var t=[];return Object.values(g).filter((function(t){return!!e.find((function(e){return!!Object.values(e.parameters).find((function(e){return e.includes("var.".concat(t))}))}))})).forEach((function(e){var n=function(e){var t;return(t={},w(t,g.BUCKET_NAME,"Name of S3 bucket"),w(t,g.AWS_REGION,"Region to deploy to, e.g. eu-north-1, us-east-1"),w(t,g.AWS_ACCESS_KEY,"e.g. AKIA... found in your AWS console > Security credentials"),w(t,g.AWS_SECRET_KEY,"e.g. yaAS$1... found in your AWS console > Security credentials"),w(t,g.ACL,"e.g. AKIA... found in your AWS console > Security credentials"),w(t,g.ERROR_RESPONSE_CODE,"e.g. HTTP status code response when no file matching path is found"),w(t,g.ERROR_RESPONSE_PATH,"e.g. Which file Cloudfront serves when encountering a missing file"),t)[e]}(e);n?(t.push('variable "'.concat(e,'" {')),t.push('  description = "'.concat(n,'"')),t.push("}")):t.push('variable "'.concat(e,'" {}'))})),t.push(""),t},Ge=function(e){var t=e.webApp,n=e.configureDns,r=e.moduleName,o=e.prefix,a=void 0===o?"":o,i=[];return i.push({value:"module.".concat(r,".BUCKET_NAME"),label:"".concat(a,"BUCKET_NAME"),description:'"Use this to configure CI for automatic deployment"'}),t&&(n||i.push({value:"module.".concat(r,".CLOUDFRONT_URL"),label:"".concat(a,"CLOUDFRONT_URL"),description:'"Your webapp will be available at this URL."'}),i.push({value:"module.".concat(r,".CLOUDFRONT_DISTRIBUTION_ID"),label:"".concat(a,"CLOUDFRONT_DISTRIBUTION_ID"),description:'"Use this to configure CI for automatic deployment"'})),i},Ve=function(e){var t=[];return t.push('output "'.concat(e.label,'" {')),t.push("  value = ".concat(e.value)),e.description&&t.push("  description = ".concat(e.description)),t.push("}"),t},Qe=function(e){var t=[];t.push.apply(t,y(function(e){if(!e.webApp)return[];var t=xe(e),n=e.bucketName,r=e.region,o=e.staticPage,a=e.errorPath,i={name:t.main,source:"git::https://github.com/tomfa/terraform.git//webapp",parameters:{bucket_name:n?'"'.concat(n,'"'):"var.".concat(g.BUCKET_NAME),aws_region:r?'"'.concat(r,'"'):"var.".concat(g.AWS_REGION),error_path:o&&a?'"/'.concat(a,'"'):'"/index.html"',error_code:o?"404":"200"}};if(e.createCertificates&&(i.parameters.certificate_arn="module.certificate.CERTIFICATE_ARN"),e.configureDns&&n&&(i.parameters.domain_aliases='["'.concat(n,'"]')),!e.staging)return[i];var l=He({},i,{name:t.staging,parameters:He({},i.parameters,{bucket_name:'"'.concat(Pe(n),'"')})});return e.configureDns&&n&&(l.parameters.domain_aliases='["'.concat(We(n),'"]')),[i,l]}(e))),t.push.apply(t,y(function(e){if(e.webApp)return[];var t=[],n=xe(e),r=e.bucketName,o=e.region,a=e.shared;return t.push({name:n.main,source:"git::https://github.com/tomfa/terraform.git//files",parameters:{bucket_name:r?'"'.concat(r,'"'):"var.".concat(g.BUCKET_NAME),aws_region:o?'"'.concat(o,'"'):"var.".concat(g.AWS_REGION),acl:a?'"public-read"':'"private"'}}),e.staging&&t.push({name:n.staging,source:"git::https://github.com/tomfa/terraform.git//files",parameters:{bucket_name:'"'.concat(Pe(r),'"'),aws_region:o?'"'.concat(o,'"'):"var.".concat(g.AWS_REGION),acl:a?'"public-read"':'"private"'}}),t}(e))),t.push.apply(t,y(function(e){var t=e.configureDns,n=e.bucketName;if(!t)return[];var r=x(n);return[{name:"domain",source:"git::https://github.com/tomfa/terraform.git//domain",parameters:{domain:'"'.concat(r,'"')}}]}(e))),t.push.apply(t,y(Be(e))),t.push.apply(t,y(function(e){var t=e.createCertificates,n=e.bucketName,r=e.configureDns;if(!t)return[];var o=x(n),a=["*.".concat(o)];n!==o&&a.push(n),a.push(We(n));var i=a.length>0?'["'.concat(a.join('","'),'"]'):"[]",l={name:"certificate",source:"git::https://github.com/tomfa/terraform.git//certificate",parameters:{domain:'"'.concat(o,'"'),alternative_names:"".concat(i)}};return r&&(l.parameters.route53_zone_id="module.domain.DOMAIN_ZONE_ID"),[l]}(e))),t.push.apply(t,y(function(e){var t=e.forwardingBucket,n=e.bucketName,r=e.region;return t?[{name:"redirect",source:"git::https://github.com/tomfa/terraform.git//redirect",parameters:{bucket_name:'"'.concat(t,'"'),redirect_url:'"'.concat(n,'"'),aws_region:'"'.concat(r,'"')}}]:[]}(e))),t.push.apply(t,y(function(e){var t=e.webApp,n=e.bucketName;if(!n)return[];var r={bucket_names:'["'.concat(n,'"]'),iam_user_name:'"'.concat(n,'-user"')};return t&&(r.cloudfront_distribution_ids="[module.web-app.CLOUDFRONT_DISTRIBUTION_ID]"),[{name:"user",source:"git::https://github.com/tomfa/terraform.git//user",parameters:r}]}(e)));var n=[];return n.push.apply(n,y(Xe(t))),n.push.apply(n,y(function(e){var t=[];return e.forEach((function(e){t.push('module "'.concat(e.name,'" {')),t.push('  source = "'.concat(e.source,'"')),Object.entries(e.parameters).forEach((function(e){var n=Object(_.a)(e,2),r=n[0],o=n[1];t.push("  ".concat(r," = ").concat(o))})),t.push("}"),t.push("")})),t}(t))),n.push.apply(n,y(function(e){var t=[],n=xe(e),r=Ge($e({},e,{moduleName:n.main,prefix:e.staging?"production-":""}));return e.staging&&r.push.apply(r,y(Ge($e({},e,{moduleName:n.staging,prefix:"staging-"})))),e.configureDns?r.push({value:"module.domain.DNS_SERVERS",label:"DNS_SERVERS",description:'"Set your DNS pointers to these values with your existing registrar."'}):e.createCertificates&&r.push({value:"module.certificates.CERTIFICATE_DNS_VALIDATION_POINTERS",label:"CERTIFICATE_DNS_VALIDATION_POINTERS",description:'"Add CNAME pointers to these values from your existing DNS to validate the certificate."'}),r.push({value:"module.user.AWS_ACCESS_KEY_ID",label:"AWS_ACCESS_KEY_ID",description:'"Use this key for CI to configure automatic deploys. It will only have access to these new resources."'},{value:"module.user.AWS_SECRET_ACCESS_KEY",label:"AWS_SECRET_ACCESS_KEY",description:'"Use secret key for CI to configure automatic deploys."'}),r.forEach((function(e){return t.push.apply(t,y(Ve(e)))})),t}(e))),n},Ze=o.a.createElement,Je=le.c.svg.withConfig({displayName:"LoadingIcon__Svg",componentId:"sc-1nn4cpf-0"})(["margin:5rem auto;display:block;shape-rendering:auto;& path{fill:",";}"],(function(e){return e.theme.colors.primary})),et=function(e){var t=e.size,n=void 0===t?300:t;return Ze(Je,{xmlns:"http://www.w3.org/2000/svg",width:"".concat(n,"px"),height:"".concat(n,"px"),viewBox:"0 0 100 100",preserveAspectRatio:"xMidYMid"},Ze("g",{transform:"translate(50 50)"},Ze("g",null,Ze("animateTransform",{attributeName:"transform",type:"rotate",values:"0;45",keyTimes:"0;1",dur:"0.2s",repeatCount:"indefinite"}),Ze("path",{d:"M29.491524206117255 -5.5 L37.491524206117255 -5.5 L37.491524206117255 5.5 L29.491524206117255 5.5 A30 30 0 0 1 24.742744050198738 16.964569457146712 L24.742744050198738 16.964569457146712 L30.399598299691117 22.621423706639092 L22.621423706639096 30.399598299691114 L16.964569457146716 24.742744050198734 A30 30 0 0 1 5.5 29.491524206117255 L5.5 29.491524206117255 L5.5 37.491524206117255 L-5.499999999999997 37.491524206117255 L-5.499999999999997 29.491524206117255 A30 30 0 0 1 -16.964569457146705 24.742744050198738 L-16.964569457146705 24.742744050198738 L-22.621423706639085 30.399598299691117 L-30.399598299691117 22.621423706639092 L-24.742744050198738 16.964569457146712 A30 30 0 0 1 -29.491524206117255 5.500000000000009 L-29.491524206117255 5.500000000000009 L-37.491524206117255 5.50000000000001 L-37.491524206117255 -5.500000000000001 L-29.491524206117255 -5.500000000000002 A30 30 0 0 1 -24.742744050198738 -16.964569457146705 L-24.742744050198738 -16.964569457146705 L-30.399598299691117 -22.621423706639085 L-22.621423706639092 -30.399598299691117 L-16.964569457146712 -24.742744050198738 A30 30 0 0 1 -5.500000000000011 -29.491524206117255 L-5.500000000000011 -29.491524206117255 L-5.500000000000012 -37.491524206117255 L5.499999999999998 -37.491524206117255 L5.5 -29.491524206117255 A30 30 0 0 1 16.964569457146702 -24.74274405019874 L16.964569457146702 -24.74274405019874 L22.62142370663908 -30.39959829969112 L30.399598299691117 -22.6214237066391 L24.742744050198738 -16.964569457146716 A30 30 0 0 1 29.491524206117255 -5.500000000000013 M0 -20A20 20 0 1 0 0 20 A20 20 0 1 0 0 -20"}))))},tt=le.c.span.withConfig({displayName:"Mutestyle__Mute",componentId:"sc-12r7eop-0"})(["color:",";"],(function(e){return e.theme.colors.textMuted})),nt=n("iaY6"),rt=le.c.pre.withConfig({displayName:"Prestyle__Pre",componentId:"sc-1cjlqsr-0"})(["position:relative;background-color:#3a3a3a;color:white;padding:1rem;margin-top:1.7rem;margin-bottom:1.7rem;overflow:auto;min-height:4rem;"]),ot=le.c.button.withConfig({displayName:"PreButtonstyle__PreButton",componentId:"sc-1i8d5dz-0"})(["background-color:",";color:",";position:absolute;font-family:monospace;bottom:20px;right:20px;border:none;padding:0.3rem 0.6rem;cursor:pointer;outline-color:",";@media (min-width:769px){top:20px;bottom:unset;}"],(function(e){return e.theme.colors.bgPrimary}),(function(e){return e.theme.colors.textPrimary}),(function(e){return e.theme.colors.secondary})),at=o.a.createElement,it=function(e){var t=e.mainTfContent,n=e.bucketName,i=e.intro,l=e.footer,c=Object(nt.b)(),u=Object(r.useState)(!1),s=u[0],p=u[1],d=Object(r.useCallback)((function(){!function(e){var t=window.document.createElement("textarea");t.setAttribute("style","position: absolute; bottom: 0; top: 0; width: 1; height: 1; opacity: 0.01;"),e.forEach((function(e){t.append(e),t.append("\n")})),document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}(t),p(!0)}),[t]);return Object(r.useEffect)((function(){return p(!1)}),[t,n]),at(o.a.Fragment,null,!!i&&at("p",null,i),at(rt,{style:!!i&&{marginTop:0}},t.map((function(e,t){return e.trim().startsWith("#")?at(tt,{key:t},e,"\n"):at("span",{key:t},e,"\n")})),at(ot,{onClick:d},s&&at("span",null,"Copied! ",at(a.a,{color:c.colors.success},"\u2713"))||"Copy to clipboard")),!!l&&at(de,null,l))},lt=function(){return window&&window.location?window.location.origin||"".concat(window.location.protocol,"//").concat(window.location.hostname):"https://ihasabucket.it"},ct=n("Q2XR"),ut=o.a.createElement,st=le.c.svg.withConfig({displayName:"Share__Svg",componentId:"sc-177gq3a-0"})(["display:inline;margin-left:0.5rem;margin-right:0.3rem;& path{fill:",";}"],(function(e){return e.color||e.theme.colors.secondary})),pt=function(e){var t=e.size,n=void 0===t?12:t,r=e.color;return ut(st,{xmlns:"http://www.w3.org/2000/svg",width:"".concat(n,"px"),height:"".concat(n,"px"),viewBox:"0 0 59 59",color:r},ut("path",{d:"M47,39c-2.671,0-5.182,1.04-7.071,2.929c-0.524,0.524-0.975,1.1-1.365,1.709l-17.28-10.489 C21.741,32.005,22,30.761,22,29.456c0-1.305-0.259-2.549-0.715-3.693l17.284-10.409C40.345,18.142,43.456,20,47,20 c5.514,0,10-4.486,10-10S52.514,0,47,0S37,4.486,37,10c0,1.256,0.243,2.454,0.667,3.562L20.361,23.985 c-1.788-2.724-4.866-4.529-8.361-4.529c-5.514,0-10,4.486-10,10s4.486,10,10,10c3.495,0,6.572-1.805,8.36-4.529L37.664,45.43 C37.234,46.556,37,47.759,37,49c0,2.671,1.04,5.183,2.929,7.071C41.818,57.96,44.329,59,47,59s5.182-1.04,7.071-2.929 C55.96,54.183,57,51.671,57,49s-1.04-5.183-2.929-7.071C52.182,40.04,49.671,39,47,39z"}))},dt=o.a.createElement,ft=function(e){var t=e.children,n=e.text,o=void 0===n?"ihasabucket.it":n,a=e.url,i=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=Object(A.useRouter)(),n=Object(r.useMemo)((function(){var n=t.query?"".concat(t.pathname,"?").concat(E.a.stringify(t.query)):t.pathname;return e?"".concat(lt()).concat(n):n}),[t.query,t.pathname,t.route]);return n}(!0);return Object(r.useMemo)((function(){return navigator&&navigator.share}),[navigator.share])?dt(ct.a,{thin:!0,onClick:function(){return navigator.share({text:o,url:a||i})}},t||"Share this page",dt(pt,{color:"white"})):dt("a",{href:a||i},t||"Share this page")},ht=function(e){var t=e.bucketName,n=e.webApp,r=e.region,o=e.shared,a=r?" in ".concat(r):"";return t&&r?"Launch ".concat(t).concat(a):n&&r?"Launch a web app ".concat(a):!n&&r?"Host ".concat(o?"public":"private"," files in ").concat(a):void 0},mt=o.a.createElement,gt=function(){var e=ae().hasAnsweredAll,t=oe(),n=Object(r.useState)(!0),a=n[0],i=n[1];if(Object(r.useEffect)((function(){return Object(R.a)("completed",t)}),[]),Object(r.useEffect)((function(){e&&setTimeout((function(){return i(!1)}),800)}),[e]),!e)return null;if(a)return mt(et,null);var l=function(e){var t={title:"First, create a folder for your infrastructure code.",tfContent:["mkdir infrastructure","cd infrastructure"]},n={title:"Then, create a terraform config file",tfContent:["cat <<EOT >> ".concat(e.bucketName||"main",".tf")].concat(y(Qe(e)),["EOT"])};if(!e.configureDns)return{sections:[t,n,{title:"Initialize the modules and deploy to AWS",tfContent:["terraform init","terraform deploy"]}].filter((function(e){return e})),footerText:Le(e)};return{sections:[t,n,{title:"Download the required modules, then create the DNS servers",tfContent:["terraform init","terraform deploy -target=module.domain"]},{title:"Deploy the remaining infrastructure to AWS",tfContent:["terraform deploy"]}],footerText:Le(e)}}(t),c=l.footerText,u=l.sections;return mt(o.a.Fragment,null,mt(ie.a,{as:"h1"},"Bucket is served!"),mt(de,null,"Copy-paste the commands below, or share this"," ",mt(ft,{text:ht(t)},"configuration url")," for later."),u.map((function(e,n){return mt(it,{key:n,bucketName:t.bucketName,intro:e.title,footer:e.description,mainTfContent:e.tfContent})})),mt(de,{style:{fontWeight:"bold"}},"The script above will plan the infrastructure and prompt you for confirmation."),c.map((function(e,t){return mt(de,{key:t},e)})))},bt=function(){return mt(a.c,{id:"infrastructure",tight:!0},mt(gt,null))},yt=o.a.createElement,wt=function(){return ae().hasAnsweredAll?yt(a.c,{tight:!0},yt(ie.a,null,"Prerequisites"),yt("h4",null,"AWS Account"),yt("p",null,"If you don't have an AWS account already, sign up at"," ",yt("a",{href:"https://portal.aws.amazon.com/billing/signup#/start"},"aws.amazon.com")),yt("p",null,"If you don't have your ",yt("strong",null,"AWS_SECRET_ACCESS_KEY")," and"," ",yt("strong",null,"AWS_ACCESS_KEY_ID")," handy, find those in the top right corner under your name > Security credentials. They should be exported to your environment:"),yt(rt,null,yt(tt,null,"# Export AWS keys","\n"),"export AWS_SECRET_ACCESS_KEY=yaAS$1...","\n","export AWS_ACCESS_KEY_ID=AKIA..."),yt("h4",null,"Terraform installed"),yt("p",null,"If you haven't already,"," ",yt("a",{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli"},"install Terraform")),yt(rt,null,yt(tt,null,"# For Macs with homebrew","\n"),"brew install hashicorp/tap/terraform"),yt(de,null,"See"," ",yt("a",{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli"},"learn.hashicorp.com/tutorials/terraform/install-cli")," ","for other platforms.")):null},vt=r.createElement,St={value:"local",label:"Command line"},_t={value:"github",label:"Github Actions"},Ot={value:"circleCI",label:"Circle CI"},Et={value:"wercker",label:"Oracle Wercker"},At={value:"gitlab",label:"Gitlab CI"},Ct=[St,_t,At,Ot,Et],kt=function(e){var t=e.summary;return vt(r.Fragment,null,vt("p",null,"1. Download and install the"," ",vt("a",{href:"https://aws.amazon.com/cli/"},"AWS CLI"),"."),vt("p",null,"2. Add the following to your package.json"),vt(rt,null,'"scripts": {',vt("br",null),"  ","...",vt("br",null),"  ",'"deploy": "aws s3 sync build/ s3://',t.bucketName||"my-beautiful-bucket",'"',vt("br",null),"}",vt("br",null)),vt("p",null,"This will sync the local folder build to s3. You might have to adjust that for your own setup."),vt("p",null,"With the script above, you will be able to deploy to S3 using"," ",vt("code",null,"yarn deploy")," locally, given that you have your AWS credentials in the environment."))},It=function(e){e.summary;return vt(r.Fragment,null,vt("p",null,"1. Add the following code to your ",vt("code",null,"wercker.yml")),vt(rt,null,"deploy_frontend:",vt("br",null),"  ","steps:",vt("br",null),"    ","- script:",vt("br",null),"      ","name: install dependencies",vt("br",null),"      ","code: yarn",vt("br",null),"    ","- script:",vt("br",null),"      ","name: build frontend",vt("br",null),"      ","code: npm run build",vt("br",null),"    ","- s3sync:",vt("br",null),"      ","source_dir: build",vt("br",null),"      ","delete-removed: true",vt("br",null),"      ","key-id: $AWS_ACCESS_KEY_ID",vt("br",null),"      ","key-secret: $AWS_SECRET_ACCESS_KEY",vt("br",null),"      ","bucket-url: s3://$AWS_S3_BUCKET_NAME",vt("br",null),"    ","- script:",vt("br",null),"      ","name: invalidate cloudfront cache",vt("br",null),"      ","code: |",vt("br",null),"        ",'if [[ -n "$AWS_CDN_DISTRIBUTION_ID" ]]; then',vt("br",null),"          ","sudo apt-get update",vt("br",null),"          ","sudo apt-get install unzip -y",vt("br",null),"          ","sudo apt-get install libpython-dev -y",vt("br",null),"          ","wget https://s3.amazonaws.com/aws-cli/awscli-bundle.zip",vt("br",null),"          ","unzip awscli-bundle.zip",vt("br",null),"          ","sudo ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws",vt("br",null),"          ","rm -rf awscli-bundle*",vt("br",null),"          ","aws configure set aws_access_key_id $AWS_ACCESS_KEY_ID",vt("br",null),"          ","aws configure set aws_secret_access_key $AWS_SECRET_ACCESS_KEY",vt("br",null),"          ",'aws cloudfront create-invalidation --distribution-id $AWS_CDN_DISTRIBUTION_ID --paths "/*"',vt("br",null),"        ","fi"),vt("p",null,"Set this pipeline up in"," ",vt("a",{href:"https://app.wercker.com"},"app.wercker.com")," with the required keys, and add a workflow to run it on master."))},Tt=function(e){var t=e.summary;return vt(r.Fragment,null,vt("p",null,"1. Add the following file to your repo:"," ",vt("code",null,".github/workflows/main.yml")),vt(rt,null,"name: Production Build",vt("br",null),"on:",vt("br",null),"  ","pull_request:",vt("br",null),"  ","push:",vt("br",null),"    ","branches:",vt("br",null),"      ","- master",vt("br",null),"jobs:",vt("br",null),"  ","build:",vt("br",null),"    ","runs-on: ubuntu-latest",vt("br",null),vt("br",null),"    ","strategy:",vt("br",null),"      ","matrix:",vt("br",null),"        ","node-version: [13.x]",vt("br",null),vt("br",null),"    ","steps:",vt("br",null),"    ","- uses: actions/checkout@v1",vt("br",null),"    ","- name: Use Node.js ${{ matrix.node-version }}",vt("br",null),"      ","uses: actions/setup-node@v1",vt("br",null),"      ","with:",vt("br",null),"        ","node-version: ${{ matrix.node-version }}",vt("br",null),"    ","- name: Yarn Install",vt("br",null),"      ","run: |",vt("br",null),"        ","yarn install",vt("br",null),"    ","- name: Production Build",vt("br",null),"      ","run: |",vt("br",null),"        ","yarn build",vt("br",null),"    ","- name: Deploy to S3",vt("br",null),"      ","uses: jakejarvis/s3-sync-action@master",vt("br",null),"      ","with:",vt("br",null),"        ","args: --acl public-read --delete",vt("br",null),"      ","env:",vt("br",null),"        ","AWS_S3_BUCKET: ${{ secrets.AWS_PRODUCTION_BUCKET_NAME }}",vt("br",null),"        ","AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}",vt("br",null),"        ","AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}",vt("br",null),"        ",'AWS_REGION: "',t.region,'"',vt("br",null),"        ",'SOURCE_DIR: "public"',"    ","- name: Invalidate Cloudfront cache","      ","uses: awact/cloudfront-action@master","      ","env:","        ","SOURCE_PATH: '/*'","        ",'AWS_REGION: "eu-north-1"',"        ","AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}","        ","AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}","        ","DISTRIBUTION_ID: ${{ secrets.CLOUDFRONT_DISTRIBUTION_ID }}"),vt("p",null,"Set this up in the Actions tab in your Github repo."))},Nt=function(e){e.summary;return vt(r.Fragment,null,vt("p",null,"See"," ",vt("a",{href:"https://hackernoon.com/using-gitlab-ci-cd-to-auto-deploy-your-vue-js-application-to-aws-s3-9affe1eb3457"},"this article")," ","for some hints."),vt(rt,null,"deploy prod:",vt("br",null)," image: python:latest",vt("br",null)," stage: deploy",vt("br",null)," only:",vt("br",null),"   ","- tags",vt("br",null)," script:",vt("br",null),"   ","- pip install awscli",vt("br",null),"   ","- aws s3 sync ./dist s3://YOUR_BUCKET_NAME"))},Dt=function(e){e.summary;return vt("p",null,"See"," ",vt("a",{href:"https://circleci.com/developer/orbs/orb/circleci/aws-s3#commands-sync"},"CircleCI S3 Orbs"))},jt=function(e){var t=e.summary,n=Object(r.useState)(_t),o=n[0],a=n[1];return vt(r.Fragment,null,vt("p",null,"Depends where you want to deploy it from."),vt(De,{id:"deployment",options:Ct,selectedOption:o,onChange:a,title:""}),o===St&&vt(kt,{summary:t}),o===Et&&vt(It,{summary:t}),o===_t&&vt(Tt,{summary:t}),o===At&&vt(Nt,{summary:t}),o===Ot&&vt(Dt,{summary:t}))},Rt=le.c.div.withConfig({displayName:"FAQAnswerstyles__FAQAnswer",componentId:"ni0grw-0"})(["padding-left:1rem;border-left:2px solid grey;display:",";"],(function(e){return e.open?"block":"none"})),xt=le.c.button.withConfig({displayName:"QuestionTitlestyles__QuestionTitle",componentId:"w5tvgt-0"})(["width:100%;background:none;border:2px dashed transparent;outline:none;text-align:left;font-size:1.3rem;padding:0;margin-top:0.3rem;&:focus,&:active{color:",";& + ","{border-left-color:",";}}"],(function(e){return e.color||e.theme.colors.secondary}),Rt,(function(e){return e.color||e.theme.colors.secondary})),Pt=o.a.createElement,Wt=function(e){return Pt(o.a.Fragment,null,e.split("\n").map((function(e,t){return Pt("p",{key:t},e)})))},Lt=function(e){var t=e.question,n=Object(r.useState)(!1),o=n[0],a=n[1],i="string"===typeof t.answer?Wt(t.answer):t.answer;return Pt("div",{id:t.id},Pt(xt,{onClick:function(){return a((function(e){return!e}))}},t.title),Pt(Rt,{open:o},i))},Ut=o.a.createElement,Ft=function(e){return[{id:"faq:deploy",title:"How do I deploy to this S3 bucket?",answer:Ut(jt,{summary:e})},{id:"faq:charged",title:"How much will I be charged?",answer:Ut(o.a.Fragment,null,Ut("p",null,"Very little."),Ut("p",null,"S3 and Cloudfront are basic, cheap infrastructure. Since AWS charges per use, it's impossible to say exactly, but 1$ per month would likely covers 1000 monthly users for a lightweight web app."),Ut("p",null,"If you have recently signed up for AWS, the expenses will commonly be included in the free tier and you won't pay anything at all."),Ut("p",null,"For more details on file hosting and data transfer fees, see"," ",Ut("a",{href:"https://aws.amazon.com/s3/pricing/"},"aws.amazon.com/s3/pricing"),"."))},{id:"faq:pre-deploy-change",title:"Can I change the input before I deploy it?",answer:Ut(o.a.Fragment,null,Ut("p",null,"Yes, go right ahead!"),Ut("p",null,"Hopefully, the arguments and code is self-explainatory. If not, check out"," ",Ut("a",{href:"http://github.com/tomfa/terraform"},"github.com/tomfa/terraform")," ","or the"," ",Ut("a",{href:"https://registry.terraform.io/providers/hashicorp/aws/latest"},"Terraform registry"),", which contains the modules which the repo uses."))},{id:"faq:stuck-on-validation",title:"My deployment is stuck on verification of certificate.",answer:Ut(o.a.Fragment,null,Ut("p",null,"The script will stop and wait for the certificate settings to be verified to be correct before continuing."),Ut("p",null,"If you use AWS DNS,"," ",e.configureDns&&Ut("strong",null,"which it looks like you do \u2013"),"go to your domain registrar, then configure the DNS servers to point to the newly created Route 53 zone that this script has created. You can find the DNS servers that you must point to in the"," ",Ut("a",{href:"https://console.aws.amazon.com/route53/v2/hostedzones#"},"AWS console > Route 53"),"."),Ut("p",null,"If you use a different DNS,"," ",!e.configureDns&&e.createCertificates&&Ut("strong",null,"which it looks like you do \u2013 "),"you must add DNS records there to match the records wanted from AWS Certificate manager. These records can be found at"," ",Ut("a",{href:"https://console.aws.amazon.com/route53/v2/hostedzones#"},"AWS console > Certificate Manager")),Ut("p",null,"Both of these methods require DNS propagation before they take effect, so you might have to wait an hour or even a day. The script times out after 45 min, but you can re-run it tomorrow, and it will continue where it left off."),Ut("p",null,"A last resort, can be to add the following line inside terraform code:"),Ut(rt,null,'module "certificate" { ',Ut("br",null),"  ","... ",Ut("br",null),"  ","validation_method = EMAIL ",Ut("br",null),"}"),Ut("p",null,"Note that you will have to respond to an email sent to postmaster@your-bucket-domain for the validation to go through, and that this process will have to be re-run every 3 years or so."))},{id:"faq:name-taken",title:"My bucket name was taken",answer:Ut(o.a.Fragment,null,Ut("p",null,"You can rename your bucket and try again. If you want to keep your the domain name, simply replace the bucket_name variables in the script, but keep the domain variables, and run the script again."),Ut("p",null,"Tip: you can go to replace-me.s3.amazonaws.com to check if a given bucket is available. If it's not take, it will reply with error message ",Ut("code",null,"The specified bucket does not exist")))},{id:"faq:deploy-twice",title:"What happens if I deploy it twice?",answer:Ut(o.a.Fragment,null,Ut("p",null,"If you still have your ",Ut("code",null,"terraform.tfstate")," file, it will check the AWS resources, and check that they still match the code. If necessary, it will ask for confirmation before changing the infrastructure to match the code."),Ut("p",null,"If you don't have your state file, it will attempt to recreate everything. It will likely fail due to a duplicate bucket name, unless you've changed that."))},{id:"faq:post-deploy-change",title:"Can I change the input and redeploy?",answer:Ut(o.a.Fragment,null,Ut("p",null,"Yes. You can change the region, bucket name and most other things.",e.createCertificates&&Ut(o.a.Fragment,null,"Note that if you make changes that affect the certificate it might be re-created."," ",!e.configureDns&&Ut(o.a.Fragment,null,"Since you seem to not be using AWS for DNS, you will then have to reconfigure the DNS pointers to the certificate afterwards."))),Ut("p",null,"When you want to apply the changes, just re-run"," ",Ut("code",null,"terraform apply"),"."))},{id:"faq:terraform-destroy",title:"How can I remove everything I just created?",answer:Ut("p",null,Ut("code",null,"terraform destroy")," will take down all created infrastructure, as long as you have kept the"," ",Ut("code",null,"terraform.tfstate")," file. If not, you will have to delete it from the ",Ut("a",{href:"https://console.aws.amazon.com/"},"AWS console"),".")},{id:"faq:generated-files",title:"What do I do with the generated files?",answer:Ut(o.a.Fragment,null,Ut("h4",null,"Short answer:"),Ut("p",null,"Save ",Ut("code",null,"terraform.tfstate")," for use later. The"," ",Ut("code",null,".terraform")," folder is basically a cache, and can be deleted."),Ut("h4",null,"Longer answer:"),Ut("p",null,"After you have run ",Ut("code",null,"terraform apply"),", a folder will be created named ",Ut("code",null,".terraform")," along with a file named"," ",Ut("code",null,"terraform.tfstate")),Ut("p",null,"If you save ",Ut("code",null,"terraform.tfstate")," you can make changes in the code, and re-apply to make those changes take effect in the infrastructure. This file is also needed to perform"," ",Ut("code",null,"terraform destroy")," in case you wish to take down the infrastructure."),Ut("p",null,"It's OK to delete everything as well, but then you'll have to make further changes using the"," ",Ut("a",{href:"https://console.aws.amazon.com"},"AWS console"),"."))}]},Yt=function(){var e=ae().hasAnsweredAll,t=oe();if(!e)return null;var n=Ft(t);return Ut(a.c,{id:"faq"},Ut(ie.a,null,"Frequently asked questions"),n.map((function(e){return Ut(Lt,{key:e.id,question:e})})))},qt=o.a.createElement;function Mt(){return qt(a.b,null,qt(re,null,qt(i.a,null),qt(s,null),qt(Re,null),qt(bt,null),qt(wt,null),qt(Yt,null),qt(l.a,null)))}},GEYT:function(e,t){var n="complete",r="canceled";function o(e,t,n){e.self===e?e.scrollTo(t,n):(e.scrollLeft=t,e.scrollTop=n)}function a(e){var t=e._scrollSettings;if(t){var r=t.maxSynchronousAlignments,i=function(e,t){var n,r,o,a,i,l,c,u=e.align,s=e.target.getBoundingClientRect(),p=u&&null!=u.left?u.left:.5,d=u&&null!=u.top?u.top:.5,f=u&&null!=u.leftOffset?u.leftOffset:0,h=u&&null!=u.topOffset?u.topOffset:0,m=p,g=d;if(e.isWindow(t))l=Math.min(s.width,t.innerWidth),c=Math.min(s.height,t.innerHeight),r=s.left+t.pageXOffset-t.innerWidth*m+l*m,o=s.top+t.pageYOffset-t.innerHeight*g+c*g,o-=h,a=(r-=f)-t.pageXOffset,i=o-t.pageYOffset;else{l=s.width,c=s.height,n=t.getBoundingClientRect();var b=s.left-(n.left-t.scrollLeft),y=s.top-(n.top-t.scrollTop);r=b+l*m-t.clientWidth*m,o=y+c*g-t.clientHeight*g,r-=f,o-=h,r=Math.max(Math.min(r,t.scrollWidth-t.clientWidth),0),o=Math.max(Math.min(o,t.scrollHeight-t.clientHeight),0),a=r-t.scrollLeft,i=o-t.scrollTop}return{x:r,y:o,differenceX:a,differenceY:i}}(t,e),l=Date.now()-t.startTime,c=Math.min(1/t.time*l,1);if(t.endIterations>=r)return o(e,i.x,i.y),e._scrollSettings=null,t.end(n);var u=1-t.ease(c);if(o(e,i.x-i.differenceX*u,i.y-i.differenceY*u),l>=t.time)return t.endIterations++,a(e);!function(e){if("requestAnimationFrame"in window)return window.requestAnimationFrame(e);setTimeout(e,16)}(a.bind(null,e))}}function i(e){return e.self===e}function l(e,t,n,o){var l,c=!t._scrollSettings,u=t._scrollSettings,s=Date.now(),p={passive:!0};function d(e){t._scrollSettings=null,t.parentElement&&t.parentElement._scrollSettings&&t.parentElement._scrollSettings.end(e),n.debug&&console.log("Scrolling ended with type",e,"for",t),o(e),l&&(t.removeEventListener("touchstart",l,p),t.removeEventListener("wheel",l,p))}u&&u.end(r);var f=n.maxSynchronousAlignments;return null==f&&(f=3),t._scrollSettings={startTime:s,endIterations:0,target:e,time:n.time,ease:n.ease,align:n.align,isWindow:n.isWindow||i,maxSynchronousAlignments:f,end:d},"cancellable"in n&&!n.cancellable||(l=d.bind(null,r),t.addEventListener("touchstart",l,p),t.addEventListener("wheel",l,p)),c&&a(t),l}function c(e){return"pageXOffset"in e||(e.scrollHeight!==e.clientHeight||e.scrollWidth!==e.clientWidth)&&"hidden"!==getComputedStyle(e).overflow}function u(){return!0}function s(e){if(e.assignedSlot)return s(e.assignedSlot);if(e.parentElement)return"BODY"===e.parentElement.tagName?e.parentElement.ownerDocument.defaultView||e.parentElement.ownerDocument.ownerWindow:e.parentElement;if(e.getRootNode){var t=e.getRootNode();if(11===t.nodeType)return t.host}}e.exports=function(e,t,r){if(e){"function"===typeof t&&(r=t,t=null),t||(t={}),t.time=isNaN(t.time)?1e3:t.time,t.ease=t.ease||function(e){return 1-Math.pow(1-e,e/2)};var o,a=s(e),i=1,p=t.validTarget||u,d=t.isScrollable;for(t.debug&&(console.log("About to scroll to",e),a||console.error("Target did not have a parent, is it mounted in the DOM?"));a;)if(t.debug&&console.log("Scrolling parent node",a),p(a,i)&&(d?d(a,c):c(a))&&(i++,o=l(e,a,t,f)),!(a=s(a))){f(n);break}return o}function f(e){--i||r&&r(e)}}}},[["/EDR",0,2,1,3,4]]]);